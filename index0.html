<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Chapter CafÃ© - é˜…è¯»å¦‚å“å’–å•¡</title>
  <!-- å­—ä½“å¼•å…¥ -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /************ é¢œè‰²ã€å…¨å±€å˜é‡ ************/
    :root {
      --coffee-deep: #3e2723;
      --milk-white: #f9f5f0;
      --amber-gold: #ffbe76;
      --night-blue: #22314a;
      --soft-shadow: 0 6px 32px 0 rgba(34, 49, 74, 0.18);
      --card-radius: 1.3rem;
      --card-glow: 0 0 24px 12px rgba(255,190,118,0.12);
      --text-typer: 'Courier New', Courier, monospace;
      --text-sans: 'Poppins', 'PingFang SC', 'Microsoft YaHei', sans-serif;
      --header-height: 64px;
      --header-height-mobile: 54px;
      --section-gap: 40px;
      --transition-fast: 0.32s cubic-bezier(.25,.8,.24,1.1);
      --transition-slow: 0.7s cubic-bezier(.22,.7,.36,1.08);
    }

    html, body {
      margin: 0;
      padding: 0;
      background:
        linear-gradient(rgba(40, 25, 15, 0.68), rgba(34, 49, 74, 0.82)),
        url('https://images.unsplash.com/photo-1559925393-8be0ec4767c8?auto=format&fit=crop&w=1950&q=80');
      background-size: cover;
      background-position: center center;
      background-attachment: fixed;
      min-height: 100vh;
      min-width: 100vw;
      width: 100vw;
      height: 100vh;
      font-family: var(--text-sans);
      color: var(--milk-white);
      box-sizing: border-box;
      scroll-behavior: smooth;
      overflow-x: hidden;
    }
    body::after {
      content: '';
      display: block;
      position: fixed; z-index: -1; inset: 0;
      background:
        radial-gradient(circle at 60% 19%, rgba(255,190,118,0.09) 0, transparent 70%),
        radial-gradient(circle at 26% 86%, rgba(244,229,196, 0.13) 0, transparent 57%);
      pointer-events: none;
      mix-blend-mode: lighten;
    }
    main {
      width: 100vw;
      min-height: calc(100vh - 160px);
    }

    /* =========== å“åº”å¼é¡¶éƒ¨å¯¼èˆªï¼ˆå«ç§»åŠ¨ç«¯èœå•ï¼‰ =========== */
    header {
      width: 100vw;
      padding: 0;
      background: rgba(34,49,74,0.84);
      box-shadow: 0 1px 18px 0 rgba(34,49,74,0.07);
      position: fixed;
      top: 0; left: 0;
      z-index: 100;
      display: flex;
      justify-content: center;
      align-items: center;
      height: var(--header-height);
      transition: height .23s;
    }
    .nav-inner {
      width: 100%;
      max-width: 1340px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2.2rem;
      height: 100%;
    }
    .logo {
      font-family: var(--text-typer);
      font-size: 2.0rem;
      color: var(--amber-gold);
      user-select: none;
      letter-spacing: .05em;
      display: flex; align-items: center;
      text-shadow: 1px 4px 16px rgba(255,190,118,0.18);
    }
    nav {
      display: flex;
      gap: 1.36rem;
      align-items: center;
      transition: none;
    }

    .nav-link, .nav-link-mobile {
      font-size: 1.14rem;
      color: var(--milk-white);
      font-family: var(--text-sans);
      letter-spacing: 0.035em;
      text-decoration: none;
      background: transparent;
      border: none;
      cursor: pointer;
      position: relative;
      padding: 0.38em 0.7em;
      transition: color .22s;
      outline: none;
    }
    .nav-link::after {
      content: "";
      display: block;
      width: 0;
      height: 2px;
      background: var(--amber-gold);
      border-radius: 1px;
      transition: width .28s;
      margin-top: 4px;
      position: absolute;
      left: 12%;
    }
    .nav-link.active, .nav-link:hover, .nav-link:focus {
      color: var(--amber-gold);
    }
    .nav-link.active::after,
    .nav-link:hover::after { width: 76%; }

    /* æ±‰å ¡èœå•æŒ‰é’® */
    .nav-hamburger {
      display: none;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.3rem;
      margin-left: 2rem;
      outline: none;
      z-index: 130;
    }
    .nav-hamburger span, .nav-hamburger span::before, .nav-hamburger span::after {
      display: block;
      background: var(--amber-gold);
      height: 3.4px;
      border-radius: 3px;
      width: 28px;
      transition: all .24s;
      position: relative;
    }
    .nav-hamburger span {
      position: relative;
      margin: .38em 0;
    }
    .nav-hamburger span::before,
    .nav-hamburger span::after {
      content: '';
      position: absolute;
      left: 0;
      width: 100%;
    }
    .nav-hamburger span::before {
      top: -9px;
    }
    .nav-hamburger span::after {
      top: 9px;
    }

    /* å“åº”å¼é€‚é…ï¼šå¹³æ¿ä¸ä¸‹æŠ˜å ä¸ºæ±‰å ¡èœå• */
    @media (max-width: 900px) {
      header {
        height: var(--header-height-mobile);
      }
      .nav-inner {
        padding: 0 1.1rem;
      }
      nav {
        display: none;
        position: absolute;
        top: var(--header-height-mobile);
        right: 0;
        background: rgba(34,49,74,0.97);
        flex-direction: column;
        align-items: flex-end;
        min-width: 170px;
        width: 46vw;
        max-width: 220px;
        box-shadow: -2px 8px 32px #00000044;
        border-bottom-left-radius: 16px;
        z-index: 110;
      }
      nav.open {
        display: flex;
        animation: fadein-right .27s;
      }
      @keyframes fadein-right {
        from { opacity: 0; transform: translateX(60px);}
        to   { opacity: 1; transform: translateX(0);}
      }
      .nav-hamburger { display: block; }
    }
    /* æ¨ªå±éå¸¸å°è®¾å¤‡èœå•å¤šè¡Œæ’åˆ—å…¼å®¹ */
    @media (max-width:520px) {
      nav { width: 100vw; min-width: 0; right: -7%; }
    }

    /* ============= æ¿å—å†…å®¹é—´è· & å“åº”å¼æ’ç‰ˆ ============= */
    .section {
      min-height: 74vh;
      width: 100vw;
      margin: 0 auto;
      padding: calc(var(--header-height) + var(--section-gap)) 0 var(--section-gap) 0;
      display: none;
      opacity: 0;
      transition: opacity var(--transition-fast) .02s;
      position: relative;
      z-index: 20;
    }
    .section.active {
      display: block;
      opacity: 1;
      animation: fadein-slow .77s;
    }
    @keyframes fadein-slow {
      from { opacity:0; filter: blur(21px); }
      to   { opacity:1; filter: blur(0);}
    }
    @media (max-width:900px) {
      .section { padding-top: calc(var(--header-height-mobile) + 22px); }
    }

    /* === é¦–é¡µä¸»è§†è§‰åŒºåŸŸ Hero Section === */
    .hero-title {
      font-size: 3.13rem;
      letter-spacing: .065em;
      font-family: var(--text-typer);
      color: var(--amber-gold);
      margin-bottom: 1.08rem;
      text-align: center;
      text-shadow: 0 4px 32px #44301960;
      opacity: 0;
      animation: fadein-up 0.95s 0.12s forwards;
    }
    .hero-subtitle {
      font-size: 1.45rem;
      letter-spacing: .08em;
      font-family: var(--text-sans);
      color: var(--milk-white);
      opacity: 0;
      margin-bottom: 2.3rem;
      text-align: center;
      animation: fadein-up 1.1s 0.32s forwards;
    }
    .enter-btn {
      font-family: var(--text-sans);
      font-size: 1.19rem;
      background: linear-gradient(90deg, var(--amber-gold) 60%, #fad096 100%);
      color: var(--coffee-deep);
      border: none;
      border-radius: 2.2rem;
      padding: 0.79rem 2.2rem;
      margin-top: 2.6rem;
      margin-bottom: 18px;
      cursor: pointer;
      letter-spacing: 0.07em;
      box-shadow: 0 1px 16px 0 #ffe5b680;
      outline: none;
      opacity: 0;
      transform: translateY(26px);
      transition: box-shadow .24s, transform .19s;
      animation: fadein-up 1.15s 0.62s forwards;
      position: relative;
      overflow: hidden;
    }
    .enter-btn:hover,
    .enter-btn:focus {
      box-shadow: 0 2px 24px 0 #ffe5b6d5;
      transform: translateY(-5px) scale(1.045);
    }
    @keyframes fadein-up {
      0% { opacity:0; transform: translateY(29px);}
      100% { opacity:1; transform: translateY(0);}
    }
    /* å“åº”å¼Heroå­—ä½“ */
    @media (max-width:600px) {
      .hero-title { font-size: 2.02rem; }
      .hero-subtitle { font-size: 1.12rem; }
      .enter-btn, .back-btn {
        font-size: .99rem; padding: 0.6rem 1.3rem;
      }
    }

    /* === å’–å•¡å¡ç‰‡èœå• Coffee Menu === */
    .coffee-list {
      display: grid;
      grid-template-columns: repeat(5, minmax(160px, 1fr));
      gap: 2.1rem;
      max-width: 1220px;
      margin: 0 auto;
      padding: 1.4rem 1.1rem 1.2rem 1.1rem;
      justify-content: center;
    }
    @media (max-width:1100px) {
      .coffee-list { grid-template-columns: repeat(3, 1fr);}
    }
    @media (max-width:700px) {
      .coffee-list { grid-template-columns: repeat(2, 1fr);}
    }
    @media (max-width:480px) {
      .coffee-list { grid-template-columns: 1fr;}
    }

    .coffee-card {
      background: linear-gradient(132deg, #4b3621 64%, var(--night-blue) 100%);
      border-radius: var(--card-radius);
      box-shadow: var(--soft-shadow);
      margin-top: 0.2rem;
      padding: 2rem 1.25rem 1.6rem 1.25rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: transform 0.37s cubic-bezier(.19,.7,.43,1.4), box-shadow .27s;
      position: relative;
      overflow: visible;
      z-index: 1;
      opacity: 0.96;
      min-width: 0; /*é˜²æ­¢å†…å®¹æº¢å‡º*/
    }
    .coffee-card:hover, .coffee-card:focus {
      transform: translateY(-18px) scale(1.04);
      box-shadow:
        0 2px 32px 0 #ffbe7644,
        0 0 24px 6px var(--amber-gold);
      z-index: 2;
    }
    /* å‘å…‰åŠ¨ç”» */
    .coffee-card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: var(--card-radius);
      background:
        radial-gradient(circle at 48% 26%, #deb67c28 0 70%, transparent 83%);
      opacity: 0;
      transition: opacity 0.38s;
      pointer-events: none;
      z-index: 1;
    }
    .coffee-card:hover::before, .coffee-card:focus::before {
      opacity: 1;
    }
    .coffee-icon {
      font-size: 3.4rem;
      margin-bottom: .7rem;
      text-shadow: 0 2px 20px #a77850a4;
      user-select: none;
      pointer-events: none;
      transition: filter .23s;
    }
    .coffee-title {
      font-family: var(--text-typer);
      font-size: 1.35rem;
      letter-spacing: .07em;
      color: var(--amber-gold);
      margin-bottom: 0.38rem;
      text-align: center;
      user-select: none;
      text-shadow: 0 2px 10px #64482cf0;
    }
    .coffee-desc {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0.4em 0 0.3em 0;
      font-size: 1.06rem;
    }
    .coffee-tag {
      font-size: 1.13em;
      color: var(--amber-gold);
      font-family: var(--text-typer);
      text-align: center;
      margin-bottom: 0.12em;
      letter-spacing: 0.02em;
      font-weight: bold;
      line-height: 1.2;
    }
    .coffee-detail {
      font-family: var(--text-sans);
      text-align: center;
      color: var(--milk-white);
      line-height: 1.63;
      font-size: 1.06rem;
      margin-bottom: 0.1em;
    }
    /* è’¸æ±½åŠ¨ç”»ï¼ˆå’–å•¡æ¯ï¼‰ */
    .steam {
      position: absolute;
      top: 32px; left: 50%;
      transform: translateX(-50%);
      opacity: .55;
      z-index: 10;
      pointer-events: none;
      width: 54px; height: 43px;
      display: flex;
      flex-direction: row;
      gap: 11px;
    }
    .steam span {
      display: block;
      width: 8px;
      height: 34px;
      background: linear-gradient(180deg, #fffbe2cc 23%, transparent 92%);
      border-radius: 25px;
      opacity: 0.45;
      filter: blur(2.1px);
      animation: steam-rise 2.7s ease-in-out infinite;
      margin-top: 6px;
    }
    .steam span:nth-child(2) { animation-delay: .7s;width: 10px; filter: blur(3.2px);}
    .steam span:nth-child(3) { animation-delay: 1.3s;width: 7px; filter: blur(2.4px); opacity: .27;}
    @keyframes steam-rise {
      0%   { opacity: 0.18; transform: translateY(16px) scaleX(1);}
      25%  { opacity: 0.6; transform: translateY(0)   scaleX(1.07);}
      47%  { opacity: 0.37;}
      75%  { opacity: 0.11; transform: translateY(-25px) scaleX(1.09);}
      100% { opacity: 0;   transform: translateY(-36px) scaleX(1);}
    }

    /* ====== é˜…è¯»åŒº/å…³äºåŒº ====== */
    .reading-placeholder,
    .about-text {
      background: rgba(69,49,32,0.26);
      border-radius: 1.2rem;
      padding: 2.2rem 2.1rem 1.3rem 2.2rem;
      max-width: 700px;
      margin: 2.5rem auto 0 auto;
      box-shadow: 0 1px 14px #23232864;
      color: #FFE3B6;
      line-height: 1.65;
      font-size: 1.16rem;
      font-family: var(--text-sans);
    }
    .reading-placeholder {
      min-height: 120px;
      text-align: center;
      color: #a6d3ff;
    }
    .about-text {
      color: #ffd999;
      text-align: left;
      font-size: 1.13rem;
    }

    /* ====== Bean AIæŒ‰é’®ä¸èŠå¤©çª— ====== */
    /* æ›¿æ¢ï¼š.bean-fab */
    .bean-fab {
      position: fixed;
      right: 2.6rem;              /* å†…ç¼©ä¸€äº›ï¼Œç¦»å³è¾¹æ›´è¿œäº› */
      bottom: 2.6rem;             /* å†…ç¼©ä¸€äº›ï¼Œç¦»åº•éƒ¨æ›´è¿œäº› */
      width: 72px; height: 72px;  /* ä» 56px -> 72pxï¼ŒæŒ‰æ¯”ä¾‹æ”¾å¤§èƒŒæ™¯åœ† */
      background: linear-gradient(120deg, #8d5524 70%, #c68642 100%);
      border-radius: 50%;
      box-shadow: 0 10px 36px #150a0522; /* å½±å­ç›¸åº”æ”¾å¤§ */
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 999;
      transition: box-shadow .22s, transform .18s;
      animation: breath 2.7s ease-in-out infinite;
    }
    @keyframes breath {
      0%, 100% { transform: translateY(0) scale(1);} 
      50%      { transform: translateY(-6px) scale(1.07);} 
    }
    /* æ›¿æ¢ï¼š.bean-emojiï¼ˆå›¾ç‰‡æˆ– inline å…ƒç´ ï¼‰ */
    .bean-emoji {
      display: block;
      width: 3.2rem;              /* ä» 2.2rem -> 3.2remï¼Œå’Œåœ†å½¢å®¹å™¨æˆæ¯”ä¾‹ */
      height: 3.2rem;
      object-fit: contain;
      pointer-events: none;
      user-select: none;
      filter: drop-shadow(0 3px 12px #c6864280); /* é˜´å½±ä¹Ÿç›¸åº”å¢å¤§ */
    }
    /* æ›¿æ¢ï¼š#bean-chatï¼ˆèŠå¤©çª—å£ä¸Šç§»ï¼Œé¿å…é®æŒ¡ï¼‰ */
    #bean-chat {
      display: none;
      position: fixed;
      bottom: 118px;               /* åŸæ¥ 83pxï¼Œéš .bean-fab æ”¾å¤§ä¸Šç§»ï¼ˆçº¦ +13pxï¼‰*/
      right: 2.6rem;              /* ä¸ .bean-fab ä¿æŒå¯¹é½ */
      width: 330px;
      background: rgba(46,31,27,0.97);
      box-shadow: 0 2px 32px 0 #24160dc6;
      border-radius: 1.3rem;
      z-index: 990;
      overflow: hidden;
      flex-direction: column;
      animation: chat-show .18s;
    }
    #bean-chat.active { display: flex; }
    @keyframes chat-show {
      from { opacity: 0; transform: translateY(60px);} 
      to   { opacity: 1; transform: translateY(0);} 
    }
    .bean-chat-header {
      background: linear-gradient(90deg, #ffbe76 70%, #c68642 100%);
      color: #543b26;
      font-family: var(--text-sans);
      font-size: 1.13rem;
      padding: 1.1rem 1.2rem 0.7rem 1.1rem;
    }
    .bean-chat-messages {
      height: 120px;
      background: transparent;
      padding: 0.8rem 1.18rem;
      color: var(--milk-white);
      font-size: 1rem;
      font-family: var(--text-sans);
      overflow-y: auto;
      flex: 1;
    }
    .bean-chat-input-area {
      padding: 0.8rem 1.13rem;
      background: #382415;
      border-top: 1px solid #5a3e29;
      display: flex;
      gap: 0.7rem;
      align-items: center;
    }
    .bean-chat-input {
      flex: 1;
      padding: 0.55em 1.01em;
      border: none;
      border-radius: 1.1rem;
      font-size: 1rem;
      font-family: var(--text-sans);
      background: #fff8e7;
      color: #51361a;
      outline: none;
      transition: box-shadow .18s;
    }
    .bean-chat-send {
      background: linear-gradient(90deg, var(--amber-gold), #fad096 100%);
      border: none;
      border-radius: 50%;
      width: 38px; height: 38px;
      font-size: 1.21rem;
      color: var(--coffee-deep);
      cursor: pointer;
      box-shadow: 0 2px 8px #ffbe7620;
      transition: background .2s;
    }
    /* Beanç§»åŠ¨ç«¯é€‚é… */
    @media (max-width:600px) {
      .bean-fab { right: 4vw; bottom: 2vw; }
      #bean-chat { width: 94vw; right: 2vw; bottom: 75px;}
    }
    



    /* ====== é¡µè„š ====== */
    footer {
      margin-top: 5.2rem;
      width: 100vw;
      padding: 2.2rem 1.2rem 1.2rem 1.2rem;
      background: rgba(31, 20, 15, 0.92);
      color: var(--amber-gold);
      font-family: var(--text-typer);
      font-size: 1.11rem;
      text-align: center;
      letter-spacing: .07em;
      position: relative;
      z-index: 20;
      box-shadow: 0 -1px 24px #22314a50;
    }
    .footer-social {
      margin-top: 0.6rem;
      display: flex;
      justify-content: center;
      gap: 1.10rem;
    }
    .footer-social a {
      color: var(--amber-gold);
      font-size: 1.35rem;
      margin: 0 0.17rem;
      text-decoration: none;
      transition: color .22s;
    }
    .footer-social a:hover { color: #fff8e7; }
    .footer-copyright {
      margin-top: 0.25rem;
      color: #f9f5f080;
      font-family: var(--text-sans);
      font-size: 0.98rem;
      letter-spacing: .03em;
    }
    .hero-center-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 70vh;
      height: calc(100vh - var(--header-height) - 48px);
      width: 100%;
      box-sizing: border-box;
      transform: translateY(-7vh);
    }
    .menu-intro {
      text-align: center;
      font-size: 1.65rem;
      color: #a6d3ff;
      font-family: var(--text-typer);
      margin-bottom: 2.7rem;
      margin-top: 2.8rem;
      letter-spacing: .07em;
      text-shadow: 0 2px 14px #22314a44;
      font-weight: bold;
    }
    #section-menu .coffee-list {
      margin-top: 2.1rem;
    }

    /* ===== æ–°å¢ï¼šmenu å­å¯¼èˆªä¸ä¹¦å•æ ·å¼ï¼ˆä¸å½±å“åŸæœ‰å¸ƒå±€ï¼‰ ===== */
    .menu-subnav-wrap {
      max-width: 1220px;
      margin: 0 auto 6px 1.1rem;
      padding: 0 1.1rem;
    }
    .menu-subnav {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      overflow-x: auto;
      padding: 6px 6px;
      scrollbar-width: thin;
    }
    .menu-subnav button {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      background: rgba(255,255,255,0.03);
      color: var(--milk-white);
      border: 1px solid rgba(255,255,255,0.04);
      padding: 8px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-family: var(--text-sans);
      transition: background .18s, transform .12s;
      white-space: nowrap;
    }
    .menu-subnav button:hover, .menu-subnav button:focus {
      background: linear-gradient(90deg, rgba(255,190,118,0.14), rgba(255,190,118,0.06));
      transform: translateY(-3px);
      color: var(--amber-gold);
    }
    .menu-subnav .icon { font-size: 1.35rem; }
    .menu-subnav .tag { font-family: var(--text-typer); color: var(--amber-gold); font-size: .95rem; }

    .menu-category {
      max-width: 1220px;
      margin: 1.6rem auto;
      padding: 0 1.1rem;
      background: rgba(36,30,24,0.06);
      border-radius: 12px;
    }
    .category-header {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.03);
    }
    .category-header .icon { font-size: 2.2rem; color: var(--amber-gold); }
    .category-header .title { font-family: var(--text-typer); font-size: 1.5rem; color: #ffdca8; }
    .category-header .meta { margin-left: 10px; color: #a6d3ff; font-size: 0.98rem; font-family: var(--text-sans); }

    .book-list { padding: 12px 16px 20px 16px; display: flex; flex-direction: column; gap: 12px; }
    .book-item {
      display: grid;
      grid-template-columns: 52px 1fr;
      gap: 12px; /*gap å›¾æ ‡ä¸æ ‡é¢˜ä¹‹é—´*/
      align-items: start;
      background: rgba(255,255,255,0.02);
      padding: 10px; /*padding ä¸Šä¸‹å†…è¾¹è·*/
      border-radius: 10px;
    }
    .book-item .cover {
      width: 52px; height: 76px;
      border-radius: 6px;
      background-size: cover;
      background-position: center;
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
      flex-shrink: 0;
    }
    .book-item .info { color: #fff8e7; font-size: 0.98rem; line-height: 1.34; }
    .book-item .info .title { font-weight: 600; color: #ffdca8; margin-bottom: 6px; }
    .book-item .info .meta { color: #e7d5b8;font-size: .9rem;margin-bottom:6px; }
    .book-item .brief { color: #efe6d1; font-size: .92rem; opacity: .92; }

    /* åºå·æ ·å¼ï¼ˆå·¦ä¸Šè§’å°å·ï¼‰ */
    .book-item[data-index] { position: relative; padding-left: 14px; }
    .book-item[data-index]::before {
      content: attr(data-index);
      position: absolute;
      left: -10px; top: -10px;
      background: var(--amber-gold);
      color: var(--coffee-deep);
      font-weight: 700;
      padding: 6px 8px;
      border-radius: 10px;
      font-family: var(--text-typer);
      font-size: .86rem;
    }

    @media (max-width:900px) {
      .menu-subnav-wrap { margin-left: 0; padding: 0 1.1rem; }
      .book-item { grid-template-columns: 44px 1fr; }
      .book-item .cover { width:44px; height:64px; }
    }
    /* ===== æ–°å¢ç»“æŸ ===== */

    /* ==== é˜…è¯»åŒºï¼šæœç´¢ä¸ä¸Šä¼ æ ·å¼ ==== */
.ebook-search { max-width: 880px; margin: 12px auto 0; display:flex; gap:10px; align-items:center; padding:0 12px; box-sizing:border-box; }
.ebook-search input[type="search"] {
  flex: 1;
  padding: 0.92rem 1rem;
  border-radius: 12px;
  border: 1px solid #e6e6e6;    /* è½»å¾®è¾¹æ¡†ï¼Œæå‡å¯è§æ€§ */
  background: #f3f4f6;           /* ç°ç™½è‰²å®åº•ï¼ˆéé€æ˜ï¼‰ */
  color: #222;                   /* æ·±è‰²æ–‡å­—ï¼Œæ–¹ä¾¿é˜…è¯» */
  font-size: 1rem;
  outline: none;
  box-shadow: 0 4px 18px rgba(34,49,74,0.06);
  transition: box-shadow .16s, border-color .12s;
}
.ebook-search input[type="search"]::placeholder {
  color: #7a7a7a; /* å ä½ç¬¦ç°è‰² */
}
.ebook-search input[type="search"]:focus {
  border-color: rgba(255,190,118,0.9);
  box-shadow: 0 8px 30px rgba(255,190,118,0.08);
}
.ebook-search button {
  padding:0.68rem 1.1rem;
  border-radius:12px;
  border:none;
  background: linear-gradient(90deg, var(--amber-gold), #fad096);
  color: var(--coffee-deep);
  font-weight:700;
  cursor:pointer;
  box-shadow: 0 2px 12px #ffebc020;
}
.search-meta { max-width:880px; margin:8px auto 0; color:#cfe9ff; font-size:0.95rem; padding:0 12px; }

/* ä¸Šä¼ åŒº */
.upload-area {
  max-width:880px;
  margin:1rem auto 2rem;
  padding:18px;
  border-radius:12px;
  border: 1px dashed rgba(255,255,255,0.30); /* é€æ˜åº¦æ”¹ä¸º 30%ï¼ˆ0.3ï¼‰ */
  background: rgba(255,255,255,0.02);
  text-align:center;
  color:#e6f4ff;
  transition: border-color .18s, background .18s, box-shadow .18s;
}
.upload-area.dragover { border-color: var(--amber-gold); background: rgba(255,190,118,0.03); box-shadow: 0 6px 26px rgba(34,49,74,0.18); }
.upload-area input[type=file] { display:none; }
.upload-actions { margin-top:12px; display:flex; justify-content:center; gap:8px; }
.upload-list { margin-top:12px; text-align:left; color:#ffdca8; font-size:0.95rem; padding:0 6px; }

/* æœç´¢å‘½ä¸­é«˜äº®ï¼ˆä»…è§†è§‰ï¼‰ */
.search-hit { background: rgba(255,190,118,0.12); padding:2px 6px; border-radius:6px; }

.note-entry-wrap {
  position: fixed;
  right: 2rem;
  bottom: 2rem;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.8rem 1.2rem;
  border-radius: 1.2rem;
  background: rgba(34, 49, 74, 0.92);
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
  transition: transform 0.24s, opacity 0.24s;
  opacity: 0.95;
}
.note-entry-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.8rem;
  padding: 0.75rem 1.2rem;
  border-radius: 14px;
  border: none;
  cursor: pointer;
  font-family: var(--text-sans);
  font-weight: 700;
  color: var(--milk-white);
  background: linear-gradient(132deg, #4b3621 64%, var(--night-blue) 100%);
  box-shadow: var(--soft-shadow);
  transition: transform 0.37s cubic-bezier(.19,.7,.43,1.4), box-shadow .27s, filter .18s;
  will-change: transform;
}

/* æ‚¬åœ/èšç„¦æ—¶çš„â€œä¸Šå‡ + å‘å…‰â€æ•ˆæœï¼Œå‚è€ƒ coffee-card çš„æ ·å¼ */
.note-entry-btn:hover,
.note-entry-btn:focus {
  transform: translateY(-14px) scale(1.04);
  box-shadow:
    0 2px 32px 0 rgba(255,190,118,0.27),
    0 0 24px 6px rgba(255,190,118,0.12);
  outline: none;
}

/* å›¾æ ‡ä¸æ–‡å­— */
.note-entry-btn .note-icon { font-size: 1.3rem; line-height: 1; }
.note-entry-btn .note-text { font-size: 1rem; color: #ffdca8; }

/* å°çª—/çª„å±å¾®è°ƒï¼Œé¿å…é®æŒ¡ Bean æŒ‰é’® */
@media (max-width: 600px) {
  .note-entry-wrap { bottom: 4.8rem; } /* ç§»é«˜ä¸€ç‚¹ï¼Œç»™ç§»åŠ¨è®¾å¤‡åº•éƒ¨ç•™ç©ºé—´ */
  .note-entry-btn { padding: 0.6rem 1rem; border-radius: 12px; }
  .note-entry-btn .note-text { font-size: 0.95rem; }
}
    /* ====== åŠ¨ç”»ï¼šæ¸æ˜¾ä¸ä¸Šç§» ====== */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.note-entry-wrap {
  animation: fadeInUp 0.6s ease-out forwards;
}

/* ====== Bean AIå’–å•¡è±†æŒ‰é’® åŠ¨ç”» ====== */
@keyframes beanFabPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}
.bean-fab {
  animation: beanFabPulse 2.5s ease-in-out infinite;
}
  </style>
</head>
<body>
  <!-- ======= é¡¶éƒ¨å¯¼èˆªæ  ======= -->
  <header>
    <div class="nav-inner">
      <div class="logo">Chapter CafÃ©</div>
      <button class="nav-hamburger" id="navHamburger" aria-label="èœå•">
        <span></span>
      </button>
      <nav id="mainNav">
        <button class="nav-link" data-section="home">Home</button>
        <button class="nav-link" data-section="menu">Menu</button>
        <button class="nav-link" data-section="reading">Reading</button>
        <button class="nav-link" data-section="about">About</button>
      </nav>
    </div>
  </header>
  <!-- ======= ä¸»ä½“åŒº ======= -->
  <main>
    <!-- é¦–é¡µä¸»è§†è§‰ -->
    <section class="section active" id="section-home">
      <div class="hero-center-group">
        <h1 class="hero-title">Welcome to Chapter CafÃ©</h1>
        <div class="hero-subtitle">æ¯ä¸ªæ•…äº‹ï¼Œéƒ½æœ‰å±äºå®ƒçš„é¦™æ°”</div>
        <button class="enter-btn" id="enterBtn">Enter the CafÃ©</button>
      </div>
    </section>
    <!-- å’–å•¡èœå•åŒº -->
    <section class="section" id="section-menu">
      <div class="menu-intro">ç‚¹ä¸€æ¯å’–å•¡ï¼Œå¼€å¯ä¸€æ®µæ•…äº‹ã€‚</div>
      <!-- ç§»åŠ¨ï¼šæŠŠé˜…è¯»åŒºçš„ä¹¦åæœç´¢æ¡†æ”¾åœ¨ menu åŒºï¼ˆä½äº menu-intro ä¸‹æ–¹ï¼‰ -->
      <form id="ebookSearchForm" class="ebook-search" role="search" aria-label="æœç´¢ç”µå­ä¹¦">
      <input id="ebookSearchInput" type="search" placeholder="åœ¨ç«™å†…ä¹¦åä¸­æœç´¢ï¼ˆä¾‹å¦‚ï¼šä¸œæ–¹å¿«è½¦è°‹æ€æ¡ˆ / æ¶æ„ï¼‰" aria-label="æœç´¢ç”µå­ä¹¦" />
      <button type="submit" aria-label="æœç´¢">æœç´¢</button>
      </form>
      <div id="ebookSearchMeta" class="search-meta" aria-live="polite"></div>


      <!-- ç›´æ¥ä½¿ç”¨åŸæœ‰äº”ä¸ª coffee-card ä½œä¸ºå¯¼èˆªï¼Œdata-target æŒ‡å‘é¡µé¢å†…å­æ ‡é¢˜é”šç‚¹ -->
      <div class="coffee-list">
        <div class="coffee-card" data-target="menu-espresso" tabindex="0" role="button" title="è·³è½¬åˆ° Espresso">
          <div class="steam"><span></span><span></span><span></span></div>
          <div class="coffee-icon">â˜•ï¸</div>
          <div class="coffee-title">Espresso</div>
          <div class="coffee-desc">
            <div class="coffee-tag">ã€æ‚¬ç–‘ / æ¨ç†ã€‘</div>
            <div class="coffee-detail">é¦™é†‡æµ“åšï¼Œè°œå›¢å¦‚å¤œè‰²é…é…¿ã€‚</div>
          </div>
        </div>
        <div class="coffee-card" data-target="menu-latte" tabindex="0" role="button" title="è·³è½¬åˆ° Latte">
          <div class="steam"><span></span><span></span><span></span></div>
          <div class="coffee-icon">ğŸ¥›</div>
          <div class="coffee-title">Latte</div>
          <div class="coffee-desc">
            <div class="coffee-tag">ã€è¨€æƒ… / æ²»æ„ˆã€‘</div>
            <div class="coffee-detail">å¥¶é¦™æ¸©åšï¼Œæµªæ¼«æ•…äº‹èœœæ„è¦ç»•ã€‚</div>
          </div>
        </div>
        <div class="coffee-card" data-target="menu-mocha" tabindex="0" role="button" title="è·³è½¬åˆ° Mocha">
          <div class="steam"><span></span><span></span><span></span></div>
          <div class="coffee-icon">ğŸ«</div>
          <div class="coffee-title">Mocha</div>
          <div class="coffee-desc">
            <div class="coffee-tag">ã€å¥‡å¹» / å†’é™©ã€‘</div>
            <div class="coffee-detail">å·§å…‹åŠ›çš„ç”œä¸­å¤¹ç€é­”æ³•ä¸å†’é™©ã€‚</div>
          </div>
        </div>
        <div class="coffee-card" data-target="menu-pourover" tabindex="0" role="button" title="è·³è½¬åˆ° Pour-over">
          <div class="steam"><span></span><span></span><span></span></div>
          <div class="coffee-icon">ğŸ«–</div>
          <div class="coffee-title">Pour-over</div>
          <div class="coffee-desc">
            <div class="coffee-tag">ã€æ–‡è‰º / æ•£æ–‡ã€‘</div>
            <div class="coffee-detail">æ‰‹å·¥æ…¢èƒï¼Œå¥å¥å¦‚æ¯ä¸­æ¼‚æµ®çš„å…‰å½±ã€‚</div>
          </div>
        </div>
        <div class="coffee-card" data-target="menu-iced" tabindex="0" role="button" title="è·³è½¬åˆ° Iced Americano">
          <div class="steam"><span></span><span></span><span></span></div>
          <div class="coffee-icon">ğŸ§Š</div>
          <div class="coffee-title">Iced Americano</div>
          <div class="coffee-desc">
            <div class="coffee-tag">ã€ç§‘å¹» / å“²å­¦ã€‘</div>
            <div class="coffee-detail">å†·é™ï¼Œæ·±é‚ƒï¼Œå‘äººæ·±çœã€‚</div>
          </div>
        </div>
      </div>

      <!-- ä¸‹æ–¹äº”ä¸ªå­æ ‡é¢˜é”šç‚¹ï¼ˆä¿æŒåŸæœ‰å†…å®¹ï¼Œä¸å˜ï¼‰ -->
      <div id="menu-espresso" class="menu-category" tabindex="-1" aria-labelledby="espresso-label">
        <div class="category-header">
          <div class="icon">â˜•ï¸</div>
          <div>
            <div class="title" id="espresso-label">Espresso <span class="meta">ã€æ‚¬ç–‘ / æ¨ç†ã€‘</span></div>
          </div>
        </div>
        <div class="book-list">
          <div class="book-item" data-index="1">
          <div class="cover" style="background-image:url('https://cdn.weread.qq.com/weread/cover/29/3300020529/t6_3300020529.jpg');"></div>
          <div class="info">
            <div class="title"><a href="malice.html" style="color:inherit; text-decoration:underline; text-decoration-color: rgba(255,190,118,0.36);" title="æŸ¥çœ‹æ¶æ„è¯¦æƒ…">æ¶æ„</a></div>
            <div class="meta">ä½œè€…ï¼šä¸œé‡åœ­å¾ Â· æ—¥æœ¬ </div>
            <div class="brief">èµŒä¸Šå…¨éƒ¨äººç”Ÿä¹Ÿè¦è´¯å½»åˆ°åº•çš„æ¶æ„ï¼Œç©¶ç«Ÿä»ä½•è€Œæ¥ï¼Ÿ</div>            </div>
          </div>
          <div class="book-item" data-index="2">
          <div class="cover" style="background-image:url('https://cdn.weread.qq.com/weread/cover/53/yuewen_728497/t6_yuewen_7284971680854100.jpg');"></div>
          <div class="info">
            <div class="title"><a href="murder_on_the_orient_express.html" style="color:inherit; text-decoration:underline; text-decoration-color: rgba(255,190,118,0.36);" title="æŸ¥çœ‹ä¸œæ–¹å¿«è½¦è°‹æ€æ¡ˆè¯¦æƒ…">ä¸œæ–¹å¿«è½¦è°‹æ€æ¡ˆ</a></div>
            <div class="meta">ä½œè€…ï¼šé˜¿åŠ èÂ·å…‹é‡Œæ–¯è’‚ Â· è‹±å›½ </div>
            <div class="brief">å°é—­ç©ºé—´ä¸­çš„æ‚¬ç–‘ï¼Œäººç‰©å…³ç³»é”™ç»¼ï¼Œè°œå›¢å±‚å±‚æ¨è¿›ã€‚</div>            </div>
          </div>
          <div class="book-item" data-index="3">
            <div class="cover" style="background-image:url('https://cdn.weread.qq.com/weread/cover/63/yuewen_728514/t6_yuewen_7285141680854106.jpg');"></div>
            <div class="info">
              <div class="title"><a href="and_then_there_were_none.html" style="color:inherit; text-decoration:underline; text-decoration-color: rgba(255,190,118,0.36);" title="æŸ¥çœ‹æ— äººç”Ÿè¿˜è¯¦æƒ…">æ— äººç”Ÿè¿˜</a></div>
              <div class="meta">ä½œè€…ï¼šé˜¿åŠ èÂ·å…‹é‡Œæ–¯è’‚ Â· è‹±å›½ </div>
              <div class="brief">åä¸ªé™Œç”Ÿäººè¢«é‚€è¯·åˆ°ä¸€ä¸ªå­¤å²›ä¸Šï¼Œé€ä¸€è¢«æ€ï¼ŒçœŸç›¸æ‰‘æœ”è¿·ç¦»ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="4">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">äººé—´æ¤…å­</div>
              <div class="meta">ä½œè€…ï¼šæ±Ÿæˆ·å·ä¹±æ­¥ Â· æ—¥æœ¬</div>
              <div class="brief">ä¸€éƒ¨å……æ»¡å¿ƒç†æ‚¬ç–‘ä¸ææ€–å…ƒç´ çš„çŸ­ç¯‡å°è¯´é›†ã€‚</div>
            </div>
          </div>
          <!-- è¿½åŠ ï¼šEspresso 5-20 -->
          <div class="book-item" data-index="5">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">å«Œç–‘äººXçš„çŒ®èº«</div>
              <div class="meta">ä½œè€…ï¼šä¸œé‡åœ­å¾ Â· æ—¥æœ¬</div>
              <div class="brief">é€»è¾‘ä¸æƒ…æ„Ÿæé™å¯¹å†³çš„åæ¨ç†åä½œã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="6">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ç™½å¤œè¡Œ</div>
              <div class="meta">ä½œè€…ï¼šä¸œé‡åœ­å¾ Â· æ—¥æœ¬</div>
              <div class="brief">è·¨è¶Šå¤šå¹´çš„äººæ€§å¹½æš—ä¸éšç§˜ç¾ç»Šã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="7">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ç¦å°”æ‘©æ–¯æ¢æ¡ˆé›†</div>
              <div class="meta">ä½œè€…ï¼šé˜¿ç‘ŸÂ·æŸ¯å—Â·é“å°” Â· è‹±å›½</div>
              <div class="brief">æ¼”ç»æ³•ä¸ç°ä»£ä¾¦æ¢å™äº‹çš„åŸºç¡€å…¸èŒƒã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="8">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">å·´æ–¯å…‹ç»´å°”çš„çŒçŠ¬</div>
              <div class="meta">ä½œè€…ï¼šé˜¿ç‘ŸÂ·æŸ¯å—Â·é“å°” Â· è‹±å›½</div>
              <div class="brief">é›¾éœ­è’åŸä¸ç†æ€§ç ´æ¡ˆçš„å“¥ç‰¹æ°”æ°›ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="9">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">å°¼ç½—æ²³ä¸Šçš„æƒ¨æ¡ˆ</div>
              <div class="meta">ä½œè€…ï¼šé˜¿åŠ èÂ·å…‹é‡Œæ–¯è’‚ Â· è‹±å›½</div>
              <div class="brief">åº¦å‡åœºæ™¯çš„å°é—­å¼å¿ƒç†ä¸åŠ¨æœºé“¾ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="10">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">é©¬è€³ä»–ä¹‹é¹°</div>
              <div class="meta">ä½œè€…ï¼šè¾¾å¸Œå°”Â·å“ˆç±³ç‰¹ Â· ç¾å›½</div>
              <div class="brief">ç¡¬æ±‰æ´¾çš„å†·å³»ä¸éƒ½å¸‚è…èš€è´¨æ„Ÿã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="11">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">é•¿çœ ä¸é†’</div>
              <div class="meta">ä½œè€…ï¼šé›·è’™å¾·Â·é’±å¾·å‹’ Â· ç¾å›½</div>
              <div class="brief">é»‘è‰²çƒŸé›¾ä¸æš§æ˜§é“å¾·åœ°å¸¦çš„èŒƒå¼ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="12">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">é¾™çº¹èº«çš„å¥³å­©</div>
              <div class="meta">ä½œè€…ï¼šæ–¯è’‚æ ¼Â·æ‹‰æ£® Â· ç‘å…¸</div>
              <div class="brief">æ•°æ®ä¸è®°å¿†æ’¬åŠ¨å®¶æ—é»‘æš—æ¡£æ¡ˆã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="13">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">æ²‰é»˜çš„ç¾”ç¾Š</div>
              <div class="meta">ä½œè€…ï¼šæ‰˜é©¬æ–¯Â·å“ˆé‡Œæ–¯ Â· ç¾å›½</div>
              <div class="brief">çŠ¯ç½ªå¿ƒç†ä¸æ“æ§è¯è¯­çš„åŒå±‚å‡è§†ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="14">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">æ¶ˆå¤±çš„çˆ±äºº</div>
              <div class="meta">ä½œè€…ï¼šå‰è‰å®‰Â·å¼—ç³ Â· ç¾å›½</div>
              <div class="brief">å©šå§»ç»“æ„ä¸å™äº‹ä¸å¯é æ€§çš„é€†è½¬ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="15">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">è¾¾Â·èŠ¬å¥‡å¯†ç </div>
              <div class="meta">ä½œè€…ï¼šä¸¹Â·å¸ƒæœ— Â· ç¾å›½</div>
              <div class="brief">ç¬¦å·å­¦æ‹¼å›¾ä¸èŠ‚å¥é©±åŠ¨å¼æ‚¬ç–‘ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="16">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ç«ç‘°çš„åå­—</div>
              <div class="meta">ä½œè€…ï¼šç¿è´æ‰˜Â·åŸƒç§‘ Â· æ„å¤§åˆ©</div>
              <div class="brief">ä¸­ä¸–çºªæ–‡æœ¬è¿·å®«ä¸å¤šé‡è¯ é‡Šã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="17">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">æœˆäº®å®çŸ³</div>
              <div class="meta">ä½œè€…ï¼šå¨å°”åŸºÂ·æŸ¯æ—æ–¯ Â· è‹±å›½</div>
              <div class="brief">æ—©æœŸä¾¦æ¢å¤šè§†è§’ç»“æ„çš„èŒƒä¾‹æ–‡æœ¬ã€‚</div>
            </div>
          </div>
            <div class="book-item" data-index="18">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ç‚¹ä¸çº¿</div>
              <div class="meta">ä½œè€…ï¼šæ¾æœ¬æ¸…å¼  Â· æ—¥æœ¬</div>
              <div class="brief">ç¤¾ä¼šæ´¾æ¨ç†ä¸­ç»†èŠ‚ä¸æ—¶åºçš„ç²¾å‡†æ‹¼æ¥ã€‚</div>
            </div>
          </div>
        </div> <!-- .book-list -->
      </div> <!-- #menu-espresso -->

      <div id="menu-latte" class="menu-category" tabindex="-1" aria-labelledby="latte-label">
        <div class="category-header">
          <div class="icon">ğŸ¥›</div>
          <div>
            <div class="title" id="latte-label">Latte <span class="meta">ã€è¨€æƒ… / æ²»æ„ˆã€‘</span></div>
          </div>
        </div>
        <div class="book-list">
          <div class="book-item" data-index="1">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">å°ç‹å­</div>
              <div class="meta">ä½œè€…ï¼šåœ£-åŸƒå…‹è‹ä½©é‡Œ Â· æ³•å›½</div>
              <div class="brief">ç«¥è¯èˆ¬æ¸©æŸ”çš„å™è¿°ï¼Œå…³äºç†è§£ã€é™ªä¼´ä¸çˆ±çš„åæ€ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="2">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">å‚²æ…¢ä¸åè§</div>
              <div class="meta">ä½œè€…ï¼šç®€Â·å¥¥æ–¯æ±€ Â· è‹±å›½</div>
              <div class="brief">é£è¶£ä¸çˆ±æƒ…å¹¶è¡Œï¼Œæˆé•¿ä¸ç†è§£é€æ­¥åŒ–è§£åè§ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="3">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ç®€Â·çˆ±</div>
              <div class="meta">ä½œè€…ï¼šå¤æ´›è’‚Â·å‹ƒæœ—ç‰¹ Â· è‹±å›½</div>
              <div class="brief">ä¸€éƒ¨å…³äºè‡ªæˆ‘å‘ç°ä¸çˆ±æƒ…çš„ç»å…¸å°è¯´ï¼Œæƒ…æ„ŸçœŸæŒšã€‚</div>
            </div>
          </div>
          <!-- è¿½åŠ ï¼šLatte 4-20 -->
          <div class="book-item" data-index="4">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">å°å¦‡äºº</div>
              <div class="meta">ä½œè€…ï¼šè·¯æ˜“èÂ·æ¢…Â·å¥¥å°”ç§‘ç‰¹ Â· ç¾å›½</div>
              <div class="brief">å§å¦¹æˆé•¿ä¸å¥³æ€§è‡ªæˆ‘å®šä½æ¸©æƒ…å›¾æ™¯ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="5">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">å‘¼å•¸å±±åº„</div>
              <div class="meta">ä½œè€…ï¼šè‰¾ç±³è‰Â·å‹ƒæœ—ç‰¹ Â· è‹±å›½</div>
              <div class="brief">æç«¯æƒ…æ„Ÿä¸è’åŸè±¡å¾çš„åŒé‡å›å£°ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="6">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">çº¢æ¥¼æ¢¦</div>
              <div class="meta">ä½œè€…ï¼šæ›¹é›ªèŠ¹ Â· ä¸­å›½</div>
              <div class="brief">è´¾å®ç‰å’Œæ—é»›ç‰çš„çˆ±æƒ…æ‚²å‰§ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="7">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">é£˜</div>
              <div class="meta">ä½œè€…ï¼šç›æ ¼ä¸½ç‰¹Â·ç±³åˆ‡å°” Â· ç¾å›½</div>
              <div class="brief">æˆ˜äº‰ä¸é‡å»ºèƒŒæ™¯ä¸‹å¥³æ€§éŸ§æ€§æ›²çº¿ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="8">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ç»¿å±±å¢™çš„å®‰å¦®</div>
              <div class="meta">ä½œè€…ï¼šéœ²è¥¿Â·è«å¾·Â·è’™å“¥é©¬åˆ© Â· åŠ æ‹¿å¤§</div>
              <div class="brief">å­¤å¥³èå…¥ç¾¤ä½“ä¸æƒ…æ„Ÿè‰²å½©çš„ç–—æ„ˆã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="9">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">æ·±å¤œåŠ æ²¹ç«™é‡è§è‹æ ¼æ‹‰åº•</div>
              <div class="meta">ä½œè€…ï¼šDan Millman Â· ç¾å›½</div>
              <div class="brief">å¯¹è¯ä½“å¿ƒçµæˆé•¿ä¸å†…åœ¨è§‰å¯Ÿæ—…ç¨‹ã€‚</div>
            </div>
          </div>
        </div> <!-- .book-list -->
      </div> <!-- #menu-latte -->

      <div id="menu-mocha" class="menu-category" tabindex="-1" aria-labelledby="mocha-label">
        <div class="category-header">
          <div class="icon">ğŸ«</div>
          <div>
            <div class="title" id="mocha-label">Mocha <span class="meta">ã€å¥‡å¹» / å†’é™©ã€‘</span></div>
          </div>
        </div>
        <div class="book-list">
          <div class="book-item" data-index="1">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">è¥¿æ¸¸è®°</div>
              <div class="meta">ä½œè€…ï¼šå´æ‰¿æ© Â· ä¸­å›½ </div>
              <div class="brief">ä¸­å›½å¤å…¸å››å¤§åè‘—ä¹‹ä¸€ï¼Œè®²è¿°å”åƒ§å¸ˆå¾’å››äººè¥¿å¤©å–ç»çš„æ•…äº‹ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="2">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">å“ˆåˆ©Â·æ³¢ç‰¹</div>
              <div class="meta">ä½œè€…ï¼šJÂ·KÂ·ç½—ç³ Â· è‹±å›½ </div>
              <div class="brief">é­”æ³•ä¸–ç•Œçš„å¥‡å¹»å†’é™©ï¼Œæˆé•¿ä¸å‹æƒ…çš„å²è¯—ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="3">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">é­”æˆ’</div>
              <div class="meta">ä½œè€…ï¼šJÂ·RÂ·RÂ·æ‰˜å°”é‡‘ Â· è‹±å›½ </div>
              <div class="brief">å®å¤§å¥‡å¹»ä¸–ç•Œä¸è‹±é›„å²è¯—ï¼Œæ¢è®¨å‹‡æ°”ã€ç‰ºç‰²ä¸å¸Œæœ›ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="4">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">é²æ»¨é€Šæ¼‚æµè®°</div>
              <div class="meta">ä½œè€…ï¼šä¸¹å°¼å°”Â·ç¬›ç¦ Â· è‹±å›½</div>
              <div class="brief">ä¸€ä¸ªäººåœ¨è’å²›ä¸Šçš„ç”Ÿå­˜æ•…äº‹ï¼Œæ¢è®¨å­¤ç‹¬ä¸äººæ€§çš„åšéŸ§ã€‚</div>
            </div>
          </div>
          <!-- è¿½åŠ ï¼šMocha 5-20 -->
          <div class="book-item" data-index="5">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">éœæ¯”ç‰¹äºº</div>
              <div class="meta">ä½œè€…ï¼šJÂ·RÂ·RÂ·æ‰˜å°”é‡‘ Â· è‹±å›½</div>
              <div class="brief">æ„å¤–æ—…ç¨‹ä¸å‹‡æ°”æˆé•¿çš„å…ˆå£°ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="6">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">çˆ±ä¸½ä¸æ¢¦æ¸¸ä»™å¢ƒ</div>
              <div class="meta">ä½œè€…ï¼šåˆ˜æ˜“æ–¯Â·å¡ç½—å°” Â· è‹±å›½</div>
              <div class="brief">é€»è¾‘é¢ è¦†ä¸è’è¯è§†è§‰çš„è¯­ä¹‰æ¸¸æˆã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="7">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ç»¿é‡ä»™è¸ª</div>
              <div class="meta">ä½œè€…ï¼šè±æ›¼Â·å¼—å…°å…‹Â·é²å§† Â· ç¾å›½</div>
              <div class="brief">å‹è°Šä¸è‡ªæˆ‘ç¼ºå¤±è¡¥å…¨çš„è½»å¥‡å¹»æ—…ç¨‹ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="8">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">é‡‘é“¶å²›</div>
              <div class="meta">ä½œè€…ï¼šç½—ä¼¯ç‰¹Â·è·¯æ˜“æ–¯Â·å²è’‚æ–‡æ£® Â· è‹±å›½</div>
              <div class="brief">æµ·ç›—å†’é™©ä¸æˆé•¿æ¬²æœ›çš„åŸå‹æ–‡æœ¬ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="9">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">æµ·åº•ä¸¤ä¸‡é‡Œ</div>
              <div class="meta">ä½œè€…ï¼šå„’å°”Â·å‡¡å°”çº³ Â· æ³•å›½</div>
              <div class="brief">å‰ç»ç§‘æŠ€ä¸æ¢ç´¢ç²¾ç¥çš„æ°´ä¸‹å²è¯—ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="10">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">åŸºç£å±±ä¼¯çˆµ</div>
              <div class="meta">ä½œè€…ï¼šå¤§ä»²é©¬ Â· æ³•å›½</div>
              <div class="brief">å¤ä»‡ä¸èº«ä»½é‡å¡‘çš„å±‚å±‚å¸ƒå±€å†’é™©ã€‚</div>
            </div>
          </div>
        </div> <!-- .book-list -->
      </div> <!-- #menu-mocha -->

      <div id="menu-pourover" class="menu-category" tabindex="-1" aria-labelledby="pourover-label">
        <div class="category-header">
          <div class="icon">ğŸ«–</div>
          <div>
            <div class="title" id="pourover-label">Pour-over <span class="meta">ã€æ–‡è‰º / æ•£æ–‡ã€‘</span></div>
          </div>
        </div>
        <div class="book-list">
          <div class="book-item" data-index="1">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ç“¦å°”ç™»æ¹–</div>
              <div class="meta">ä½œè€…ï¼šäº¨åˆ©Â·æˆ´ç»´Â·æ¢­ç½— </div>
              <div class="brief">å¯¹ç®€æœ´ç”Ÿæ´»ä¸è‡ªç„¶çš„æ²‰æ€ï¼Œæ–‡å­—é™è°§è€Œé¥±å«å“²ç†ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="2">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">æŒªå¨çš„æ£®æ—</div>
              <div class="meta">ä½œè€…ï¼šæ‘ä¸Šæ˜¥æ ‘ Â· æ—¥æœ¬ </div>
              <div class="brief">é’æ˜¥ã€æƒ†æ€…ä¸è®°å¿†çš„å™è¿°ï¼Œæ„Ÿæƒ…ç»†è…»ä¸”å¯Œæœ‰è¯—æ„ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="3">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">æœèŠ±å¤•æ‹¾</div>
              <div class="meta">ä½œè€…ï¼šé²è¿… Â· ä¸­å›½ </div>
              <div class="brief">é²è¿…å›å¿†ç«¥å¹´ä¸é’å¹´çš„æ•£æ–‡é›†ï¼Œæƒ…æ„ŸçœŸæŒšä¸”å¯Œæœ‰å“²ç†ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="4">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">æµ®ç”Ÿå…­è®°</div>
              <div class="meta">ä½œè€…ï¼šæ²ˆå¤ Â· ä¸­å›½ </div>
              <div class="brief">æ¸…ä»£æ–‡äººçš„ç”Ÿæ´»éšç¬”ï¼Œç»†è…»æç»˜æ—¥å¸¸ä¸æƒ…æ„Ÿã€‚</div>
            </div>
          </div>
          <!-- è¿½åŠ ï¼šPour-over 5-20 -->
          <div class="book-item" data-index="5">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ç™¾å¹´å­¤ç‹¬</div>
              <div class="meta">ä½œè€…ï¼šåŠ è¥¿äºšÂ·é©¬å°”å…‹æ–¯ Â· å“¥ä¼¦æ¯”äºš</div>
              <div class="brief">å®¶æ—å¾ªç¯ä¸å­¤ç‹¬å‘½è¿çš„é­”å¹»ç°å®ã€‚ </div>
            </div>
          </div>
          <div class="book-item" data-index="6">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">æ€æ­»ä¸€åªçŸ¥æ›´é¸Ÿ</div>
              <div class="meta">ä½œè€…ï¼šå“ˆç€Â·æ Â· ç¾å›½</div>
              <div class="brief">ç«¥å¹´è§†è§’ä¸‹çš„æ­£ä¹‰ã€åè§ä¸åŒç†ã€‚ </div>
            </div>
          </div>
          <div class="book-item" data-index="7">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">äººç±»ç¾¤æ˜Ÿé—ªè€€æ—¶</div>
              <div class="meta">ä½œè€…ï¼šæ–¯è’‚èŠ¬Â·èŒ¨å¨æ ¼ Â· å¥¥åœ°åˆ©</div>
              <div class="brief">å†å²ç¬é—´ä¸äººç‰©å¿ƒç†çš„æ•£æ–‡åŒ–å‡ç¼©ã€‚</div>
            </div>
          </div>
        </div> <!-- .book-list -->
      </div> <!-- #menu-pourover -->

      <div id="menu-iced" class="menu-category" tabindex="-1" aria-labelledby="iced-label">
        <div class="category-header">
          <div class="icon">ğŸ§Š</div>
          <div>
            <div class="title" id="iced-label">Iced Americano <span class="meta">ã€ç§‘å¹» / å“²å­¦ã€‘</span></div>
          </div>
        </div>
        <div class="book-list">
          <div class="book-item" data-index="1">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ä¸‰ä½“</div>
              <div class="meta">ä½œè€…ï¼šåˆ˜æ…ˆæ¬£ Â· ä¸­å›½ / å‡ºç‰ˆï¼š2006</div>
              <div class="brief">å®è§‚å®‡å®™è§‚ä¸äººç±»æ–‡æ˜çš„è¾ƒé‡ï¼Œæ€æƒ³æ¿€è¡ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="2">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ç¾ä¸½æ–°ä¸–ç•Œ</div>
              <div class="meta">ä½œè€…ï¼šé˜¿é“å¸Â·èµ«èƒ¥é» Â· ç¾å›½ / å‡ºç‰ˆï¼š1932</div>
              <div class="brief">ç§‘å¹»ä¸­çš„è¯—æ€§ä¸å®—æ•™ã€å‘½è¿çš„å¤šé‡æ¢è®¨ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="3">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ä»¿ç”Ÿäººä¼šæ¢¦è§ç”µå­ç¾Šå—ï¼Ÿ</div>
              <div class="meta">ä½œè€…ï¼šè²åˆ©æ™®Â·KÂ·è¿ªå…‹ Â· ç¾å›½ / å‡ºç‰ˆï¼š1968</div>
              <div class="brief">æ¢è®¨äººæ€§ä¸ç°å®çš„ç§‘å¹»ç»å…¸ï¼Œæ·±åˆ»ä¸”å¼•äººæ€è€ƒã€‚</div>
            </div>
          </div>
          <!-- è¿½åŠ ï¼šIced Americano 4-20 -->
          <div class="book-item" data-index="4">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">ä¸€ä¹å…«å››</div>
              <div class="meta">ä½œè€…ï¼šä¹”æ²»Â·å¥¥å¨å°” Â· è‹±å›½</div>
              <div class="brief">è¯­è¨€æ§åˆ¶ä¸ææƒç›‘è§†çš„é¢„è­¦å¯“è¨€ã€‚</div>
            </div>
          </div>
          <div class="book-item" data-index="13">
            <div class="cover" style="background-image:url('https://via.placeholder.com/80x110?text=å°é¢');"></div>
            <div class="info">
              <div class="title">é›ªå´©</div>
              <div class="meta">ä½œè€…ï¼šå°¼å°”Â·æ–¯è’‚èŠ¬æ£® Â· ç¾å›½</div>
              <div class="brief">è™šæ‹Ÿéƒ½å¸‚ä¸è¯­è¨€ç—…æ¯’çš„èµ›åšå¥‡æƒ³ã€‚</div>
            </div>
          </div>
        </div> <!-- .book-list -->
      </div> <!-- #menu-iced -->

    </section>

    <!-- é˜…è¯»åŒº -->
    <section class="section" id="section-reading">
      <!-- ä¸¤æ å¯è°ƒå¸ƒå±€ï¼šå·¦ä¾§é˜…è¯»ï¼ˆä¸»ï¼‰ï¼Œå³ä¾§ç¬”è®°ï¼ˆå¯æ”¶èµ·ï¼‰ - è°ƒæ•´ä¸ºæ’‘æ»¡é¡µé¢ï¼Œæ–‡æœ¬æ¡†é€æ˜åº¦10%ï¼Œæ”¶èµ·åå³ä¾§æ¶ˆå¤±ï¼Œå±•å¼€æŒ‰é’®é å³ä¸Š -->
      <style>
        /* split layout - æ’‘æ»¡å¯è§†åŒºï¼ˆç´§è´´ header ä¸‹æ–¹ï¼‰ï¼Œç§»é™¤ max-width ä»¥æ‰©å¤§ä¸¤æ è§†è§‰å®½åº¦ */
        .split-wrap {
          max-width: none;
          width: calc(100vw - 24px);
          margin: 6px auto;
          height: calc(100vh - var(--header-height) - 12px);
          min-height: 420px;
          display: flex;
          gap: 0;
          padding: 0 12px;
          box-sizing: border-box;
        }
        .split-left, .split-right {
          overflow: hidden;
          display: flex;
          flex-direction: column;
          /* ä½¿ç”¨ä¸ coffee-card ç›¸åŒçš„æ£•è‰²->è“è‰²æ¸å˜è§†è§‰ */
          background: linear-gradient(132deg, #4b3621 64%, var(--night-blue) 100%);
          border-radius: 10px;
          box-shadow: 0 8px 30px rgba(0,0,0,0.35);
        }
        /* å·¦ä¾§ä¸»åŒºç•¥å®½ï¼Œå³ä¾§ç¬”è®°ç•¥çª„ï¼›ä¸¤æ åˆå§‹å æ»¡æ›´å¤§æ¨ªå‘é¢ç§¯ */
        .split-left { flex-basis: 72%; min-width: 180px; margin-right: 6px; padding: 18px; }
        .split-right { flex-basis: 28%; min-width: 160px; margin-left: 6px; padding: 14px; position: relative; transition: width .18s ease, flex-basis .18s ease; display: flex; flex-direction: column; }
         .divider { width:8px; cursor:col-resize; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:6px; display:flex; align-items:center; justify-content:center; }
         .divider .bar { width:2px; height:48px; background:rgba(255,255,255,0.06); border-radius:2px; }
 
        /* reader content - æ›´ä½é€æ˜åº¦çš„æµ…ç°è‰²å¡«å……ï¼ˆæ˜¾è‘—å‡å°ï¼‰ */
         .reader-toolbar { display:flex; gap:8px; align-items:center; margin-bottom:10px; }
         .btn-ghost { background:transparent;border:1px solid rgba(255,255,255,0.06); color:#ffdca8; padding:8px 12px; border-radius:8px; cursor:pointer; }
         .reader-content {
            flex: 1;
            overflow: auto;
            /* ä¿æŒæµ…ç°è‰²å®åº•ä½†ç¨æœ‰é€æ˜åº¦ï¼Œè®©åº•å±‚æ£•è“æ¸å˜è‹¥éšè‹¥ç° */
            background: linear-gradient(132deg, #4b3621 64%, var(--night-blue) 100%);
            padding: 20px;
            border-radius: 8px;
            color: var(--milk-white); /* æ·±è‰²èƒŒæ™¯ä¸Šä½¿ç”¨æµ…è‰²æ–‡å­—ä»¥ä¿è¯å¯è¯»æ€§ */
            line-height: 1.7;
            font-size: 1rem;
            white-space: pre-wrap;
            box-shadow: none;
          }

         .reader-empty { color:#6b7280; text-align:center; padding:36px 12px; }
 
         /* notes */
         .notes-toolbar { display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:8px; }
        /* ç¬”è®°åŒºå¤–æ¡†ä¸å†…æ¡†ä¹Ÿé‡‡ç”¨ç›¸åŒæ¸å˜ï¼ˆtextarea ä¿æŒæµ…ç°å¡«å……ä»¥ä¾¿è¾“å…¥å¯è¯»ï¼‰ */
         .notes-area {
            width: 100%;
            height: 100%;
            min-height: 160px;
            background: linear-gradient(132deg, #4b3621 64%, var(--night-blue) 100%);
            color: var(--milk-white);
            border-radius: 6px;
            padding: 10px;
            box-sizing: border-box;
          }

    /* textarea ä¿æŒæµ…ç°èƒŒæ™¯ï¼Œä¾¿äºç¼–è¾‘æ—¶ä¸æ·±è‰²å®¹å™¨å½¢æˆå¯¹æ¯” */
        .notes-textarea {
            width: 100%;
            height: 100%;
            min-height: 160px;
            background: #f3f4f6;
            color: #111;
            border: 1px solid rgba(0,0,0,0.06);
            border-radius: 6px;
            padding: 10px;
            resize: vertical;
            font-size: 0.95rem;
            box-sizing: border-box;
          }
    /* Markdown é¢„è§ˆåŒºæ ·å¼ */
    .notes-preview {
      display: none;
      width: 100%;
      height: 100%;
      min-height: 160px;
      background: #fff8e7;
      color: #222;
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 6px;
      padding: 12px 14px;
      box-sizing: border-box;
      overflow: auto;
    }
    .notes-preview h1, .notes-preview h2, .notes-preview h3 { color: #4b3621; margin: .4em 0; }
    .notes-preview pre { background: #272822; color: #f8f8f2; padding: 8px 10px; border-radius: 6px; overflow:auto; }
    .notes-preview code { background: #f1e6d1; padding: 2px 4px; border-radius: 4px; }
    .notes-preview table { width: 100%; border-collapse: collapse; margin: 8px 0; }
    .notes-preview th, .notes-preview td { border: 1px solid #e0d4bf; padding: 6px 8px; }
    .notes-preview th { background: #fde9c6; }
    .notes-preview blockquote { border-left: 4px solid #deb67c; margin: 6px 0; padding: 6px 10px; background: #fff2d9; }
  /* é¢„è§ˆå†…çš„ç°è‰²æç¤ºæ–‡æœ¬ï¼ˆç”¨äºæ¨¡æ¿è¯´æ˜ï¼‰ */
  .notes-preview .md-hint { color:#8a8a8a; font-size:0.92em; margin:6px 0 4px 0; }

    /* è§†å›¾æ¨¡å¼æ§åˆ¶ */
    .notes-area.view-edit .notes-textarea { display: block; }
    .notes-area.view-edit .notes-preview { display: none; }
    .notes-area.view-preview .notes-textarea { display: none; }
    .notes-area.view-preview .notes-preview { display: block; }
    .notes-area.view-split { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; align-items: stretch; }
    .notes-area.view-split .notes-textarea { display: block; height: 100%; }
    .notes-area.view-split .notes-preview { display: block; height: 100%; }
         .notes-collapse-btn { position:absolute; left:-44px; top:12px; transform:translateX(-6px); width:36px; height:36px; border-radius:999px; display:flex; align-items:center; justify-content:center; background:linear-gradient(90deg,var(--amber-gold),#fad096); color:#2b160f; box-shadow:0 6px 18px rgba(0,0,0,0.32); cursor:pointer; }
 
         /* collapsed small toggle (fixed near top-right, square, å·¦ä¾§ä¸¤ä¸ªè§’å¼§åº¦) */
         .notes-mini-toggle { position:fixed; top: calc(var(--header-height) + 12px); right:12px; width:56px; height:56px; display:none; align-items:center; justify-content:center; background:linear-gradient(90deg,var(--amber-gold),#fad096); color:#2b160f; box-shadow:0 8px 30px rgba(0,0,0,0.45); cursor:pointer; z-index:1200; border-radius:8px 0 0 8px; } 
         .notes-mini-toggle.visible { display:flex; }
 
         /* å½“ç¬”è®°åŒºåŸŸè¢«æ”¶èµ·æ—¶çš„æ ·å¼ï¼ˆè§†è§‰å ä½è¢«ç§»é™¤ï¼‰ */
         .notes-collapsed { display:none !important; }

         /* ========== é˜…è¯»åŒºï¼šåˆ’è¯å¤åˆ¶æ‚¬æµ®æŒ‰é’® ========== */
         .selection-copy-btn {
           position: fixed; /* ä½¿ç”¨è§†å£å®šä½ï¼Œä¾¿äºæ ¹æ® selection rect å®šä½ */
           display: none;
           width: 34px; height: 34px;
           border: none;
           border-radius: 50%;
           background: linear-gradient(90deg, var(--amber-gold), #fad096);
           color: #2b160f;
           box-shadow: 0 8px 24px rgba(0,0,0,0.35);
           z-index: 1200;
           cursor: pointer;
           align-items: center;
           justify-content: center;
           font-size: 16px;
         }
         .selection-copy-btn:active { transform: scale(0.96); }

         /* ========== å¿«æ·ç¬”è®°èœå• ========== */
         .quick-notes-menu {
           position: fixed;
           display: none;
           min-width: 140px;
           padding: 6px;
           background: rgba(46,31,27,0.98);
           border: 1px solid rgba(255,255,255,0.06);
           border-radius: 10px;
           box-shadow: 0 8px 28px rgba(0,0,0,0.45);
           z-index: 1300;
         }
         .quick-notes-menu button {
           width: 100%;
           text-align: left;
           background: transparent;
           color: #ffdca8;
           border: none;
           border-radius: 8px;
           padding: 8px 10px;
           cursor: pointer;
         }
         .quick-notes-menu button:hover,
         .quick-notes-menu button:focus {
           background: rgba(255,190,118,0.12);
           outline: none;
         }
 
         @media (max-width:900px) {
           .split-wrap { flex-direction:column; height:auto; gap:12px; }
           .divider { display:none; }
           .notes-collapse-btn { left:auto; right:12px; transform:none; top:-22px; }
           .notes-mini-toggle { top:72px; right:10px; width:48px; height:48px; border-radius:6px 0 0 6px; }
         }
       </style>

      <div class="split-wrap" id="splitWrap" aria-label="é˜…è¯»ä¸ç¬”è®°åˆ†æ ">
        <div class="split-left" id="readerPane" role="main" aria-label="é˜…è¯»åŒºåŸŸ">
          <div class="reader-toolbar">
            <div style="font-weight:700;color:#ffdca8;">é˜…è¯»åŒº</div>
            <div style="flex:1"></div>
            <button class="btn-ghost" id="openLocalBtn" title="æ‰“å¼€æœ¬åœ° TXT">æ‰“å¼€æœ¬åœ° TXT</button>
            <input id="readerFileInput" type="file" accept=".txt" style="display:none" />
            <!-- åˆ é™¤æ¸…é™¤æŒ‰é’®ï¼Œæ–°å¢ ä¸‹ä¸€ç«  + è¿”å›ç›®å½• -->
            <button class="btn-ghost" id="nextChapterBtn" title="è·³åˆ°ä¸‹ä¸€ç« ">ä¸‹ä¸€ç«  âœ</button>
            <button class="btn-ghost" id="backDirectoryBtn" title="è¿”å›ç›®å½•é¡µ">è¿”å›ç›®å½•</button>
            <select id="readerFontSize" class="btn-ghost" title="æ–‡å­—å¤§å°" style="padding:6px 8px;">
              <option value="0.95rem">å°</option>
              <option value="1rem" selected>ä¸­</option>
              <option value="1.08rem">å¤§</option>
              <option value="1.2rem">æ›´å¤§</option>
            </select>
          </div>
          <div class="reader-content" id="readerContent">
            <div class="reader-empty" id="readerEmpty">å°šæœªåŠ è½½ä¹¦ç±ã€‚è¯·ç‚¹å‡»â€œæ‰“å¼€æœ¬åœ° TXTâ€é€‰æ‹©æœ¬åœ°æ–‡æœ¬æ–‡ä»¶ï¼Œæˆ–ä»èœå•é€‰æ‹©å¼€å§‹é˜…è¯»ã€‚</div>
          </div>
        </div>

        <div class="divider" id="divider" role="separator" aria-orientation="vertical" title="æ‹–åŠ¨è°ƒæ•´å®½åº¦">
          <div class="bar" aria-hidden="true"></div>
        </div>

        <div class="split-right" id="notesPane" role="complementary" aria-label="ç¬”è®°åŒºåŸŸ">
          <div class="notes-toolbar">
            <div style="font-weight:700;color:#ffdca8;">âœï¸ ç¬”è®°åŒº</div>
            <div style="display:flex;gap:8px;align-items:center;">
              <button class="btn-ghost" id="quickNotesBtn" title="å¿«æ·ç¬”è®°">å¿«æ·ç¬”è®° â–¾</button>
              <button class="btn-ghost" id="notesModeEditBtn" title="ä»…ç¼–è¾‘">ç¼–è¾‘</button>
              <button class="btn-ghost" id="notesModePreviewBtn" title="ä»…é¢„è§ˆ">é¢„è§ˆ</button>
              <button class="btn-ghost" id="notesModeSplitBtn" title="åˆ†æ ">åŒæ </button>
              <button class="btn-ghost" id="saveNotesBtn" title="ä¿å­˜ç¬”è®°åˆ°æœ¬åœ°">ä¿å­˜</button>
              <button class="btn-ghost" id="collapseNotesBtn" title="æ”¶èµ·ç¬”è®°">æ”¶èµ·</button>
            </div>
          </div>
          <div class="notes-area">
            <textarea id="notesTextarea" class="notes-textarea" placeholder="åœ¨æ­¤ä½¿ç”¨ Markdown è®°å½•è¯»ä¹¦ç¬”è®°ï¼ˆæ”¯æŒ # æ ‡é¢˜ã€- åˆ—è¡¨ã€è¡¨æ ¼ç­‰ï¼‰"></textarea>
            <div id="notesPreview" class="notes-preview" aria-label="Markdown é¢„è§ˆ"></div>
          </div>
        </div>
      </div>

      <!-- æ”¶èµ·åå‡ºç°çš„å³ä¾§å°æŒ‰é’®ï¼ˆå›ºå®šé è¿‘é¡¶éƒ¨å¯¼èˆªä¸‹æ–¹ï¼Œæ­£æ–¹å½¢ï¼Œå·¦ä¾§æœ‰å¼§åº¦ï¼‰ -->
      <button id="notesMiniToggle" class="notes-mini-toggle" aria-label="å±•å¼€ç¬”è®°">ğŸ“</button>

      <script>
        (function(){
          // DOM
          const divider = document.getElementById('divider');
          const splitWrap = document.getElementById('splitWrap');
          const readerPane = document.getElementById('readerPane');
          const notesPane = document.getElementById('notesPane');
          const openLocalBtn = document.getElementById('openLocalBtn');
          const readerFileInput = document.getElementById('readerFileInput');
          const readerContent = document.getElementById('readerContent');
          const readerEmpty = document.getElementById('readerEmpty');
          const nextChapterBtn = document.getElementById('nextChapterBtn');
          const backDirectoryBtn = document.getElementById('backDirectoryBtn');
          const readerFontSize = document.getElementById('readerFontSize');
          const notesTextarea = document.getElementById('notesTextarea');
          const saveNotesBtn = document.getElementById('saveNotesBtn');
          const collapseNotesBtn = document.getElementById('collapseNotesBtn');
          const notesMiniToggle = document.getElementById('notesMiniToggle');
          const quickNotesBtn = document.getElementById('quickNotesBtn');
          const notesModeEditBtn = document.getElementById('notesModeEditBtn');
          const notesModePreviewBtn = document.getElementById('notesModePreviewBtn');
          const notesModeSplitBtn = document.getElementById('notesModeSplitBtn');
          const notesAreaEl = notesPane.querySelector('.notes-area');
          const notesPreview = document.getElementById('notesPreview');
          // ä¿å­˜/åˆ·æ–°å¯¼èˆªä¿æŠ¤ç›¸å…³çŠ¶æ€
          let notesDirty = false;              // æ˜¯å¦å­˜åœ¨æœªä¿å­˜æ›´æ”¹
          let notesExplicitlySaved = true;     // ç”¨æˆ·ä¸Šæ¬¡æ˜¯å¦ç‚¹è¿‡â€œä¿å­˜â€
          const WARN_FLAG_KEY = 'notesWarnedOnce'; // é¦–æ¬¡æç¤ºæ ‡è®°ï¼ˆsessionStorageï¼‰
          // å¿«æ·ç¬”è®°èœå•ï¼ˆåŠ¨æ€åˆ›å»ºï¼‰
          const quickNotesMenu = document.createElement('div');
          quickNotesMenu.className = 'quick-notes-menu';
          quickNotesMenu.innerHTML = `
            <button type="button" data-type="settings">è®¾å®šé›†</button>
            <button type="button" data-type="outline">å¤§çº²æ€»ç»“</button>
          `;
          document.body.appendChild(quickNotesMenu);
          // åˆ’è¯å¤åˆ¶æ‚¬æµ®æŒ‰é’®ï¼ˆåŠ¨æ€åˆ›å»ºï¼‰
          const selectionCopyBtn = document.createElement('button');
          selectionCopyBtn.className = 'selection-copy-btn';
          selectionCopyBtn.title = 'å¤åˆ¶åˆ°ç¬”è®°';
          selectionCopyBtn.setAttribute('aria-label', 'å¤åˆ¶é€‰ä¸­æ–‡æœ¬åˆ°ç¬”è®°');
          selectionCopyBtn.textContent = 'ğŸ“‹';
          document.body.appendChild(selectionCopyBtn);

          // restore persisted state
          const state = { notesCollapsed: false, notesWidth: null, lastNotesWidth: null, bookText: null };
          try {
            const s = JSON.parse(localStorage.getItem('readingState') || '{}');
            if (s) Object.assign(state, s);
          } catch(e){}

          // apply saved widths if present
          if (state.notesWidth) {
            notesPane.style.flexBasis = state.notesWidth;
            // derive reader width
            const nb = parseFloat(state.notesWidth);
            if (!isNaN(nb)) {
              readerPane.style.flexBasis = `${100 - nb}%`;
            }
          }

          // load saved notes
          const savedNotes = localStorage.getItem('readerNotes') || '';
          notesTextarea.value = savedNotes;

          // load saved book
          if (localStorage.getItem('readerLastBook')) {
            const txt = localStorage.getItem('readerLastBook');
            setReaderText(txt);
          } else if (state.bookText) {
            setReaderText(state.bookText);
          }

          // file open
          openLocalBtn.addEventListener('click', ()=> readerFileInput.click());
          readerFileInput.addEventListener('change', (e)=>{
            const f = e.target.files && e.target.files[0];
            if (!f) return;
            if (!f.name.toLowerCase().endsWith('.txt')) {
              alert('ä»…æ”¯æŒ .txt æ–‡æœ¬æ–‡ä»¶');
              return;
            }
            const r = new FileReader();
            r.onload = ()=> {
              const txt = r.result || '';
              setReaderText(txt);
              localStorage.setItem('readerLastBook', txt); // persist last book
              // remember also in readingState for compatibility
              const st = JSON.parse(localStorage.getItem('readingState') || '{}') || {};
              st.bookText = txt;
              localStorage.setItem('readingState', JSON.stringify(st));
            };
            r.readAsText(f, 'utf-8');
          });

          function setReaderText(txt){
            readerContent.innerText = txt || '';
            readerEmpty.style.display = txt ? 'none' : 'block';
          }
          window._readerAPI = { setText: setReaderText };

          // font size control
          readerFontSize.addEventListener('change', (e)=>{
            readerContent.style.fontSize = e.target.value;
          });

          // notes save -> åŒæ—¶ä¸‹è½½ä¸º æœ¬åœ°TXTï¼šä¹¦å-ç« èŠ‚å-ç¬”è®°.txt
          saveNotesBtn.addEventListener('click', ()=>{
            const text = notesTextarea.value || '';
            // 1) ä»ç„¶ä¿å­˜åˆ° localStorageï¼ˆä¿ç•™åŸæœ‰åŠŸèƒ½ï¼‰
            localStorage.setItem('readerNotes', text);
            // æ ‡è®°æœ¬æ¬¡å·²æ˜¾å¼ä¿å­˜
            notesDirty = false; notesExplicitlySaved = true;
            try { sessionStorage.removeItem(WARN_FLAG_KEY); } catch(_){ }

            // 2) ç”Ÿæˆæ–‡ä»¶åï¼ˆå½“å‰ä»…æ”¯æŒã€Šæ¶æ„ã€‹ç« èŠ‚çš„å‘½åï¼›å¦åˆ™å›é€€åˆ°â€œé˜…è¯»ç¬”è®°.txtâ€ï¼‰
            function chapterTitleForMalice(n){
              switch(Number(n)){
                case 1: return 'å·ä¸€';
                case 2: return 'å·äºŒ';
                case 3: return 'å·ä¸‰';
                case 4: return 'å·å››';
                case 5: return 'å·äº”';
                case 6: return 'å·å…­';
                case 7: return 'ç–‘æƒ‘ä¹‹ç«  åŠ è´ºæ­ä¸€éƒçš„è®°å½•';
                case 8: return 'è§£å†³ä¹‹ç«  é‡é‡å£ä¿®çš„æ‰‹è®°';
                case 9: return 'æ±‚ç´¢ä¹‹ç«  åŠ è´ºæ­ä¸€éƒçš„ç‹¬ç™½';
                case 10: return 'å‘Šç™½ä¹‹ç«  é‡é‡å£ä¿®çš„æ‰‹è®°';
                case 11: return 'è¿‡å»ä¹‹ç« ï¼ˆä¸€ï¼‰åŠ è´ºæ­ä¸€éƒçš„è®°å½•';
                case 12: return 'æ®æ—ç”°é¡ºä¸€è¯´';
                case 13: return 'æ®æ–°ç”°æ²»ç¾è¯´';
                case 14: return 'æ®å…ƒè°·é›…ä¿Šè¯´';
                case 15: return 'æ®å¹¿æ³½æ™ºä»£è¯´';
                case 16: return 'æ®æ¾å²›è¡Œç”·è¯´';
                case 17: return 'æ®é«˜æ¡¥é¡ºæ¬¡è¯´';
                case 18: return 'æ®ä¸‰è°·å®ä¸€è¯´';
                case 19: return 'æ®è—¤æ‘åº·å¿—è¯´';
                case 20: return 'æ®ä¸­å†¢æ˜­å¤«è¯´';
                case 21: return 'æ®è¾»æ‘å¹³å‰è¯´';
                case 22: return 'è¿‡å»ä¹‹ç« ï¼ˆä¸‰ï¼‰åŠ è´ºæ­ä¸€éƒçš„å›å¿†';
                case 23: return 'çœŸç›¸ä¹‹ç«  åŠ è´ºæ­ä¸€éƒçš„é˜æ˜';
                default: return n ? `ç¬¬${n}ç« ` : 'æœªå®šä½ç« èŠ‚';
              }
            }
            function sanitizeFilename(name){
              return String(name)
                .replace(/[<>:"/\\|?*\u0000-\u001F]/g, '') // ç§»é™¤éæ³•å­—ç¬¦
                .replace(/\s+/g, ' ')                          // åˆå¹¶å¤šç©ºæ ¼
                .trim()
                .slice(0, 128);                                 // æ§åˆ¶æ–‡ä»¶åé•¿åº¦
            }
            function buildNotesFilename(){
              // å½“å‰ hash è‹¥æ˜¯ reading-malice-chapterN åˆ™ä½¿ç”¨ã€Šæ¶æ„ã€‹åŠå¯¹åº”ç« èŠ‚å
              const cur = getCurrentMaliceChapter() || parseInt(localStorage.getItem('maliceCurrentChapter')||'', 10);
              if (cur && cur >=1 && cur <= 23) {
                const book = 'æ¶æ„';
                const chapterName = chapterTitleForMalice(cur);
                return sanitizeFilename(`${book}-${chapterName}-ç¬”è®°.txt`);
              }
              // å…¶ä»–æƒ…å†µå›é€€é€šç”¨å‘½å
              return 'é˜…è¯»ç¬”è®°.txt';
            }

            const filename = buildNotesFilename();
            try {
              const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = filename;
              document.body.appendChild(a);
              a.click();
              setTimeout(() => {
                URL.revokeObjectURL(url);
                a.remove();
              }, 0);
              // è½»é‡åé¦ˆ
              const old = saveNotesBtn.textContent;
              saveNotesBtn.textContent = 'å·²ä¸‹è½½';
              setTimeout(()=> saveNotesBtn.textContent = old, 1200);
            } catch(e) {
              // å¤±è´¥åˆ™ç»™å‡ºæç¤º
              alert('å·²ä¿å­˜åˆ°æœ¬åœ°ï¼Œä½†è‡ªåŠ¨ä¸‹è½½å¤±è´¥ï¼š' + (e && e.message ? e.message : e));
            }
          });

          // collapse / expand notes
          function collapseNotes(){
            // remember current notes width to restore later
            state.lastNotesWidth = notesPane.style.flexBasis || getComputedStyle(notesPane).flexBasis || '34%';
            // hide notes pane and let reader occupy full width
            notesPane.classList.add('notes-collapsed');
            notesPane.style.display = 'none';
            readerPane.style.flexBasis = '100%';
            // show mini toggle near top-right
            notesMiniToggle.classList.add('visible');
            state.notesCollapsed = true;
            persistState();
          }
          function expandNotes(){
            // restore notes pane display and width
            notesPane.classList.remove('notes-collapsed');
            notesPane.style.display = 'flex';
            // restore saved width or lastNotesWidth or default
            const restore = state.notesWidth || state.lastNotesWidth || '34%';
            notesPane.style.flexBasis = restore;
            const nb = parseFloat(restore);
            if (!isNaN(nb)) {
              readerPane.style.flexBasis = `${100 - nb}%`;
            } else {
              readerPane.style.flexBasis = '66%';
            }
            notesMiniToggle.classList.remove('visible');
            state.notesCollapsed = false;
            persistState();
          }
          collapseNotesBtn.addEventListener('click', collapseNotes);
          notesMiniToggle.addEventListener('click', expandNotes);

          if (state.notesCollapsed) {
            // start collapsed if persisted
            collapseNotes();
          }

          // draggable divider
          let dragging = false;
          divider.addEventListener('mousedown', (e)=>{
            dragging = true;
            document.body.style.cursor = 'col-resize';
            e.preventDefault();
          });
          window.addEventListener('mousemove', (e)=>{
            if (!dragging) return;
            const rect = splitWrap.getBoundingClientRect();
            let x = e.clientX - rect.left;
            // clamp
            const minLeft = 160;
            const minRight = 120;
            if (x < minLeft) x = minLeft;
            if (x > rect.width - minRight) x = rect.width - minRight;
            const leftPct = (x/rect.width)*100;
            const rightPct = 100 - leftPct;
            readerPane.style.flexBasis = `${leftPct}%`;
            notesPane.style.flexBasis = `${rightPct}%`;
          });
          window.addEventListener('mouseup', ()=>{
            if (!dragging) return;
            dragging = false;
            document.body.style.cursor = '';
            // persist width
            state.notesWidth = notesPane.style.flexBasis;
            persistState();
          });
          // touch support
          divider.addEventListener('touchstart', ()=> dragging = true, {passive:true});
          window.addEventListener('touchmove', (ev)=>{
            if (!dragging) return;
            const touch = ev.touches[0];
            const rect = splitWrap.getBoundingClientRect();
            let x = touch.clientX - rect.left;
            const minLeft = 160;
            const minRight = 120;
            if (x < minLeft) x = minLeft;
            if (x > rect.width - minRight) x = rect.width - minRight;
            const leftPct = (x/rect.width)*100;
            const rightPct = 100 - leftPct;
            readerPane.style.flexBasis = `${leftPct}%`;
            notesPane.style.flexBasis = `${rightPct}%`;
          }, {passive:true});
          window.addEventListener('touchend', ()=>{
            if (!dragging) return;
            dragging = false;
            state.notesWidth = notesPane.style.flexBasis;
            persistState();
          });

          function persistState(){
            localStorage.setItem('readingState', JSON.stringify(state));
          }

          // when user navigates to #section-reading, focus/scroll reader
          if (location.hash && location.hash.includes('section-reading')) {
            setTimeout(()=> {
              readerPane.scrollIntoView({behavior:'smooth', block:'start'});
            }, 120);
          }

          // keyboard shortcut: Ctrl+S to save notes
          window.addEventListener('keydown', (e)=>{
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
              e.preventDefault();
              localStorage.setItem('readerNotes', notesTextarea.value);
              saveNotesBtn.textContent = 'å·²ä¿å­˜';
              setTimeout(()=> saveNotesBtn.textContent = 'ä¿å­˜', 900);
            }
          });

          // ========== åˆ’è¯å¤åˆ¶åˆ°ç¬”è®° ==========
          function isSelectionInReader(){
            const sel = window.getSelection();
            if (!sel || sel.rangeCount === 0 || sel.isCollapsed) return false;
            const range = sel.getRangeAt(0);
            const container = range.commonAncestorContainer;
            return readerContent.contains(container);
          }
          function getSelectedText(){
            const sel = window.getSelection();
            if (!sel || sel.rangeCount === 0) return '';
            return sel.toString();
          }
          function positionCopyButton(){
            try {
              const sel = window.getSelection();
              if (!sel || sel.rangeCount === 0 || sel.isCollapsed) { hideCopyButton(); return; }
              const range = sel.getRangeAt(0);
              const rect = range.getBoundingClientRect();
              if (!rect || (!rect.width && !rect.height)) { hideCopyButton(); return; }
              // æ”¾åœ¨é€‰æ‹©åŒºåŸŸå³ä¸Šè§’ï¼Œç•¥å‘å¤–åç§»
              const btnSize = 34;
              const padding = 6;
              let top = rect.top - btnSize - 4; // ä¸Šæ–¹
              let left = rect.right - btnSize + padding; // å³ä¾§ç•¥å
              // è§†å£å†…å®‰å…¨èŒƒå›´
              const minTop = 6, minLeft = 6;
              const maxLeft = window.innerWidth - btnSize - 6;
              const maxTop  = window.innerHeight - btnSize - 6;
              if (top < minTop) top = rect.top + 2; // è‹¥ç©ºé—´ä¸è¶³ï¼Œæ”¹æ”¾åœ¨åŒºåŸŸå†…ä¸Šè¾¹
              if (left < minLeft) left = minLeft;
              if (left > maxLeft) left = maxLeft;
              if (top > maxTop) top = maxTop;
              selectionCopyBtn.style.left = left + 'px';
              selectionCopyBtn.style.top  = top + 'px';
              selectionCopyBtn.style.display = 'flex';
            } catch(e) {
              hideCopyButton();
            }
          }
          function hideCopyButton(){
            selectionCopyBtn.style.display = 'none';
          }

          function appendToNotes(text){
            if (!text) return;
            const trimmed = text.replace(/\s+$/,'').replace(/^\s+/,'');
            if (!trimmed) return;
            const cur = notesTextarea.value;
            const prefix = cur && !cur.endsWith('\n') ? '\n' : '';
            const stamp = new Date();
            const timeStr = `${stamp.getHours().toString().padStart(2,'0')}:${stamp.getMinutes().toString().padStart(2,'0')}`;
            const toAdd = `${prefix}> å¼•ç”¨ï¼ˆ${timeStr}ï¼‰\n${trimmed}\n`;
            notesTextarea.value = cur + toAdd;
            // å°†å…‰æ ‡ç§»è‡³æœ«å°¾
            notesTextarea.focus();
            try { notesTextarea.selectionStart = notesTextarea.selectionEnd = notesTextarea.value.length; } catch(_){}
            // é¡ºä¾¿åŒæ­¥ä¸€ä¸‹æœ¬åœ°å­˜å‚¨ï¼ˆè½»é‡ï¼‰
            localStorage.setItem('readerNotes', notesTextarea.value);
            schedulePreview();
            notesDirty = true; notesExplicitlySaved = false;
          }

          // ç»‘å®šäº‹ä»¶ï¼šä»…åœ¨é˜…è¯»åŒºåŸŸå†…æœ‰æ•ˆ
          readerContent.addEventListener('mouseup', () => {
            setTimeout(() => {
              if (isSelectionInReader()) positionCopyButton(); else hideCopyButton();
            }, 0);
          });
          readerContent.addEventListener('keyup', (e) => {
            // é”®ç›˜é€‰æ‹©ï¼ˆShift+æ–¹å‘é”®ï¼‰
            if (['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].includes(e.key)) {
              if (isSelectionInReader()) positionCopyButton(); else hideCopyButton();
            }
          });
          readerContent.addEventListener('scroll', hideCopyButton);
          window.addEventListener('scroll', hideCopyButton);
          window.addEventListener('resize', hideCopyButton);
          document.addEventListener('mousedown', (e)=>{
            // ç‚¹å‡»å…¶ä»–ä½ç½®æ—¶éšè—ï¼ˆä½†ç‚¹åœ¨æŒ‰é’®æœ¬èº«ä¾‹å¤–ï¼‰
            if (e.target !== selectionCopyBtn) hideCopyButton();
          });

          selectionCopyBtn.addEventListener('click', () => {
            const txt = getSelectedText();
            appendToNotes(txt);
            hideCopyButton();
            // è½»åé¦ˆï¼šé—ªçƒæŒ‰é’®æ–‡æœ¬
            const old = selectionCopyBtn.textContent;
            selectionCopyBtn.textContent = 'âœ“';
            setTimeout(()=> selectionCopyBtn.textContent = old, 500);
          });

          // ========== å¿«æ·ç¬”è®°ï¼šæ’å…¥æ¨¡æ¿ ==========
          function insertAtCursor(text){
            const ta = notesTextarea;
            const start = ta.selectionStart || 0;
            const end = ta.selectionEnd || start;
            const before = ta.value.slice(0, start);
            const after = ta.value.slice(end);
            ta.value = before + text + after;
            const pos = before.length + text.length;
            try { ta.selectionStart = ta.selectionEnd = pos; } catch(_){ }
            ta.focus();
            localStorage.setItem('readerNotes', ta.value);
            schedulePreview();
            notesDirty = true; notesExplicitlySaved = false;
          }

          function needsSeparatorBeforeInsertion(){
            const ta = notesTextarea;
            if (!ta.value || ta.value.trim().length === 0) return false;
            const start = ta.selectionStart || 0;
            // åœ¨éå¼€å¤´ä½ç½®æ’å…¥ï¼Œä¸”å‰é¢ä¸æ˜¯ä»¥æ¢è¡Œæˆ–====ç»“æŸæ—¶ï¼Œæ·»åŠ åˆ†å‰²
            const before = ta.value.slice(0, start);
            const trimmedEnd = before.replace(/[\s\S]*\n?([\s\S]*)$/, '$1');
            // å¦‚æœå‰ä¸€è¡Œä¸æ˜¯åˆ†å‰²çº¿
            if (!before.endsWith('\n') && before.length>0) return true;
            // Markdown æ°´å¹³åˆ†å‰²çº¿ï¼š--- æˆ– *** æˆ– ___
            const hrRe = /(^|\n)\s{0,3}((?:-{3,})|(?:\*{3,})|(?:_{3,}))\s*$/;
            if (!hrRe.test(before)) return true;
            return false;
          }

          function ensureSeparatorPrefix(){
            const ta = notesTextarea;
            const start = ta.selectionStart || 0;
            // å¦‚æœåœ¨é¦–è¡Œä¸”æ–‡æœ¬ä¸ºç©ºï¼Œä¸åŠ åˆ†éš”
            if (!ta.value || ta.value.trim().length === 0) return '';
            // æ€»æ˜¯æ·»åŠ ä¸€æ¡åˆ†éš”çº¿ï¼Œå‰é¢å¦‚æœæ²¡æœ‰æ¢è¡Œåˆ™è¡¥ä¸€ä¸ªæ¢è¡Œ
            const before = ta.value.slice(0, start);
            const needLeadingNewline = before.length>0 && !before.endsWith('\n');
            return (needLeadingNewline ? '\n' : '') + '---\n';
          }

          function buildSettingsTable(){
            return 'è®¾å®šé›†\n\n| è§’è‰² | è®¾å®š |\n| --- | --- |\n|  |  |\n|  |  |\n|  |  |\n\n';
          }

          function buildOutline(){
            // æ’å…¥ä¸€ä¸ªä¸æ˜¾çœ¼çš„æµ…ç°è‰²æç¤ºï¼ˆé¢„è§ˆä¸­å‘ˆç°ï¼‰ï¼Œç¼–è¾‘æ—¶å¯åˆ é™¤
            const hint = '<div class="md-hint">æç¤ºï¼šæ¯è¡Œä»¥â€œ - ç©ºæ ¼ â€å¼€å¤´å³å¯ç”Ÿæˆä¸€æ¡å¤§çº²é¡¹ï¼›è‹¥æœ¬è¡Œåªæœ‰â€œ - â€å†æŒ‰å›è½¦å³å¯ç»“æŸåˆ—è¡¨ã€‚ï¼ˆæ­¤æç¤ºå¯åˆ é™¤ï¼‰</div>';
            return 'å¤§çº²æ€»ç»“\n' + hint + '\n- ';
          }

          function openQuickNotesMenu(){
            const rect = quickNotesBtn.getBoundingClientRect();
            quickNotesMenu.style.left = (rect.left) + 'px';
            quickNotesMenu.style.top  = (rect.bottom + 6) + 'px';
            quickNotesMenu.style.display = 'block';
          }
          function closeQuickNotesMenu(){ quickNotesMenu.style.display = 'none'; }

          quickNotesBtn.addEventListener('click', (e)=>{
            e.stopPropagation();
            if (quickNotesMenu.style.display === 'block') closeQuickNotesMenu();
            else openQuickNotesMenu();
          });
          document.addEventListener('click', (e)=>{
            if (!quickNotesMenu.contains(e.target) && e.target !== quickNotesBtn) closeQuickNotesMenu();
          });
          window.addEventListener('scroll', closeQuickNotesMenu);
          window.addEventListener('resize', closeQuickNotesMenu);

          quickNotesMenu.addEventListener('click', (e)=>{
            const t = e.target;
            if (!(t instanceof Element)) return;
            const type = t.getAttribute('data-type');
            if (!type) return;
            // ç»„è£…æ’å…¥æ–‡æœ¬
            let block = '';
            if (type === 'settings') block = buildSettingsTable();
            else if (type === 'outline') block = buildOutline();
            if (!block) return;
            // åˆ†å‰²çº¿
            const prefix = ensureSeparatorPrefix();
            insertAtCursor(prefix + block);
            closeQuickNotesMenu();
          });

          // ========== å¤§çº²æ¨¡å¼ï¼šå›è½¦è‡ªåŠ¨ç»­è¡Œï¼ˆbulleted listï¼‰ ==========
          notesTextarea.addEventListener('keydown', function(e){
            if (e.key !== 'Enter') return;
            const ta = notesTextarea;
            const start = ta.selectionStart || 0;
            const end = ta.selectionEnd || start;
            if (start !== end) return; // é€‰æ‹©èŒƒå›´æ—¶ä¸å¤„ç†
            const val = ta.value;
            const lineStart = val.lastIndexOf('\n', start - 1) + 1;
            const line = val.slice(lineStart, start);
            const bulletPrefixMatch = line.match(/^\s*([-*â€¢])\s+/);
            if (!bulletPrefixMatch) return; // éé¡¹ç›®ç¬¦å·è¡Œ
            e.preventDefault();
            const contentAfterBullet = line.replace(/^\s*([-*â€¢])\s+/, '').trim();
            const before = val.slice(0, start);
            const after  = val.slice(end);
            if (contentAfterBullet.length === 0) {
              // å½“å‰è¡Œåªæœ‰é¡¹ç›®ç¬¦å· -> ç»“æŸåˆ—è¡¨ï¼šæŠŠè¿™ä¸€è¡Œçš„ç¬¦å·å»æ‰å¹¶æ¢è¡Œ
              const beforeLine = val.slice(0, lineStart);
              const afterLine  = val.slice(start); // ä»å…‰æ ‡å¤„ä¹‹å
              ta.value = beforeLine + '\n' + afterLine;
              const newPos = beforeLine.length + 1; // æ¢è¡Œåä½ç½®
              try { ta.selectionStart = ta.selectionEnd = newPos; } catch(_){ }
            } else {
              // ç»­è¡Œæ–°æ¡ç›®
              const insert = '\n- ';
              ta.value = before + insert + after;
              const newPos = before.length + insert.length;
              try { ta.selectionStart = ta.selectionEnd = newPos; } catch(_){ }
            }
            // æŒä¹…åŒ–
            localStorage.setItem('readerNotes', ta.value);
            schedulePreview();
            notesDirty = true; notesExplicitlySaved = false;
          });
          // ========== Markdown é¢„è§ˆæ¸²æŸ“ & æ¨¡å¼åˆ‡æ¢ ==========
          function mdRender(text){
            try {
              if (window.marked && typeof window.marked.parse === 'function') {
                return window.marked.parse(text || '');
              }
            } catch(e){}
            // fallback
            const esc = (text||'').replace(/[&<>"]+/g,'');
            return '<pre style="white-space:pre-wrap;">'+esc+'</pre>';
          }
          function renderNotesPreview(){
            notesPreview.innerHTML = mdRender(notesTextarea.value);
          }
          let previewTimer = null;
          function schedulePreview(){
            if (previewTimer) clearTimeout(previewTimer);
            previewTimer = setTimeout(renderNotesPreview, 160);
          }
          notesTextarea.addEventListener('input', ()=>{
            localStorage.setItem('readerNotes', notesTextarea.value);
            schedulePreview();
            notesDirty = true; notesExplicitlySaved = false;
          });
          function setNotesViewMode(mode){
            const modes = ['edit','preview','split'];
            modes.forEach(m=> notesAreaEl.classList.remove('view-'+m));
            if(!modes.includes(mode)) mode='edit';
            notesAreaEl.classList.add('view-'+mode);
            [notesModeEditBtn, notesModePreviewBtn, notesModeSplitBtn].forEach(btn=> btn && (btn.style.opacity = 0.6));
            if(mode==='edit') notesModeEditBtn.style.opacity=1;
            if(mode==='preview') notesModePreviewBtn.style.opacity=1;
            if(mode==='split') notesModeSplitBtn.style.opacity=1;
            localStorage.setItem('notesViewMode', mode);
            if(mode!=='edit') renderNotesPreview();
          }
          notesModeEditBtn.addEventListener('click', ()=> setNotesViewMode('edit'));
          notesModePreviewBtn.addEventListener('click', ()=> setNotesViewMode('preview'));
          notesModeSplitBtn.addEventListener('click', ()=> setNotesViewMode('split'));
          setNotesViewMode(localStorage.getItem('notesViewMode') || 'edit');
          schedulePreview();
          // ========== åˆ·æ–°/è·³è½¬ä¿æŠ¤ï¼šé¦–æ¬¡æé†’ï¼ŒäºŒæ¬¡æ¸…ç©º ==========
          function hasUnsavedNotes(){
            return (notesTextarea.value.trim().length>0) && (notesDirty || !notesExplicitlySaved);
          }
          function clearNotes(){
            notesTextarea.value = '';
            try { localStorage.removeItem('readerNotes'); } catch(_){}
            notesDirty = false; notesExplicitlySaved = true;
            schedulePreview();
          }
          function showTransientBanner(msg){
            // Inject animation styles once
            let styleEl = document.getElementById('notes-exit-banner-style');
            if(!styleEl){
              styleEl = document.createElement('style');
              styleEl.id = 'notes-exit-banner-style';
              styleEl.textContent = `
                @keyframes nxb-slide { from { transform: translate(-50%, -12px) scale(.98); opacity: 0; } to { transform: translate(-50%, 0) scale(1); opacity: 1; } }
                @keyframes nxb-pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 143, 31, .65); } 70% { box-shadow: 0 0 0 14px rgba(255, 143, 31, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 143, 31, 0); } }
              `;
              document.head.appendChild(styleEl);
            }
            let el = document.getElementById('notes-exit-banner');
            if(!el){
              el = document.createElement('div');
              el.id = 'notes-exit-banner';
              document.body.appendChild(el);
            }
            el.setAttribute('role', 'alert');
            el.setAttribute('aria-live', 'assertive');
            el.style.cssText = [
              'position:fixed',
              'left:50%','top:24px','transform:translateX(-50%)',
              'background:#fff7e6','color:#592d00',
              'padding:12px 14px','border-radius:12px','border:2px solid #ff8f1f',
              'font-size:1rem','font-weight:600',
              'z-index:2600','box-shadow:0 10px 28px rgba(0,0,0,.28)',
              'display:flex','align-items:center','gap:12px',
              'animation:nxb-slide .22s ease-out, nxb-pulse 1.6s ease-out 1'
            ].join(';') + ';';
            el.innerHTML = `
              <span aria-hidden="true" style="font-size:1.2rem;line-height:1">âš ï¸</span>
              <span>${msg}</span>
              <span style="flex:1"></span>
              <button id="nxb-save" style="background:#ff8f1f;color:#1b1b1b;border:none;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer;">ç«‹å³ä¿å­˜</button>
              <button id="nxb-close" style="background:transparent;color:#592d00;border:1px solid rgba(89,45,0,.3);padding:7px 10px;border-radius:8px;cursor:pointer;">å…³é—­</button>
            `;
            const hide = () => {
              el.style.transition = 'opacity .8s, transform .8s';
              el.style.opacity = '0';
              el.style.transform = 'translateX(-50%) translateY(-8px)';
              setTimeout(()=>{ if(el && el.parentNode) el.parentNode.removeChild(el); }, 820);
            };
            const saveBtn = el.querySelector('#nxb-save');
            const closeBtn = el.querySelector('#nxb-close');
            if(saveBtn){
              saveBtn.addEventListener('click', () => {
                try {
                  const s = document.getElementById('saveNotesBtn');
                  if (s) {
                    if (typeof (s).click === 'function') (s).click();
                    else s.dispatchEvent(new Event('click'));
                  }
                } catch(_){ }
                hide();
              }, { once:true });
            }
            if(closeBtn){
              closeBtn.addEventListener('click', () => hide(), { once:true });
            }
            el.style.opacity = '1';
            try { if (el._hideTimer) clearTimeout(el._hideTimer); } catch(_){}
            el._hideTimer = setTimeout(hide, 4600);
          }
          function guardAction(run){
            if(!hasUnsavedNotes()){ run(); return; }
            let warned = false;
            try { warned = !!sessionStorage.getItem(WARN_FLAG_KEY); } catch(_){}
            if(!warned){
              try { sessionStorage.setItem(WARN_FLAG_KEY,'1'); } catch(_){}
              showTransientBanner('ç¬”è®°å°šæœªä¿å­˜ï¼šå·²é˜»æ­¢è·³è½¬/åˆ·æ–°ï¼Œå†æ¬¡æ“ä½œå°†æ¸…ç©ºç¬”è®°å¹¶ç»§ç»­ã€‚');
              return;
            }
            clearNotes();
            try { sessionStorage.removeItem(WARN_FLAG_KEY); } catch(_){}
            run();
          }
          // æš´éœ²ç»™å…¨å±€å¯¼èˆªï¼ˆèœå•/é¦–é¡µç­‰ï¼‰ä½¿ç”¨
          window.guardNotesNav = guardAction;
          // åˆ·æ–°/å…³é—­æµè§ˆå™¨æ—¶çš„æç¤ºä¸æ¸…ç©º
          window.addEventListener('beforeunload', (e)=>{
            if(!hasUnsavedNotes()) return; // allow
            let warned = false;
            try { warned = !!sessionStorage.getItem(WARN_FLAG_KEY); } catch(_){}
            if(!warned){
              try { sessionStorage.setItem(WARN_FLAG_KEY,'1'); } catch(_){}
              e.preventDefault();
              e.returnValue = 'ç¬”è®°å°šæœªä¿å­˜ï¼Œåˆ·æ–°æˆ–ç¦»å¼€å°†ä¸¢å¤±ï¼ˆå†æ¬¡åˆ·æ–°å°†æ¸…ç©ºï¼‰';
            } else {
              clearNotes();
            }
          });
          // === ç« èŠ‚å¯¼èˆªæŒ‰é’®é€»è¾‘è¡¥å…¨ ===
          function getCurrentChapter(){
            const h = (location.hash || '').slice(1);
            let m = h.match(/^reading-malice-chapter(\d{1,2})$/);
            if(m){
              const n = parseInt(m[1],10);
              return { book:'malice', chapter: (n >=1 && n<=23) ? n : null };
            }
            m = h.match(/^reading-and_then_there_were_none-chapter(\d{1,2})$/);
            if(m){
              const n = parseInt(m[1],10);
              return { book:'and_then_there_were_none', chapter: (n >=1 && n<=16) ? n : null };
            }
            return null;
          }

          function refreshChapterButtons(){
            const info = getCurrentChapter();
            if(info && info.chapter){
              const max = info.book === 'malice' ? 23 : (info.book === 'and_then_there_were_none' ? 16 : 0);
              nextChapterBtn.disabled = (info.chapter >= max);
              nextChapterBtn.style.opacity = (info.chapter >= max) ? '.45' : '1';
              backDirectoryBtn.style.display = 'inline-block';
              nextChapterBtn.style.display = 'inline-block';
            } else {
              backDirectoryBtn.style.display = 'none';
              nextChapterBtn.style.display = 'none';
            }
          }

          // æš´éœ²ç»™å…¨å±€è„šæœ¬ï¼ˆloadRemoteChapter æˆåŠŸæ—¶è°ƒç”¨ï¼‰
          window.refreshChapterButtons = refreshChapterButtons;

          backDirectoryBtn.addEventListener('click', (ev) => {
            ev.preventDefault();
            const info = getCurrentChapter();
            const detailPage = info && info.book === 'and_then_there_were_none' ? 'and_then_there_were_none.html' : 'malice.html';
            guardAction(() => { location.href = detailPage; });
          });

            // å¼ºåˆ¶åˆ·æ–° ensuring reading section visible before jump
          nextChapterBtn.addEventListener('click', (ev) => {
            ev.preventDefault();
            guardAction(() => {
              const info = getCurrentChapter();
              if(!info || !info.chapter) return;
              const max = info.book === 'malice' ? 23 : (info.book === 'and_then_there_were_none' ? 16 : 0);
              if(info.chapter >= max) return;
              const nxt = info.chapter + 1;
              location.hash = '#reading-' + info.book + '-chapter' + nxt;
              if (typeof loadRemoteChapter === 'function') {
                loadRemoteChapter(info.book, nxt);
              }
            });
          });

          // åˆå§‹ä¸ç›‘å¬
          refreshChapterButtons();
          window.addEventListener('hashchange', refreshChapterButtons);
        })();
      </script>
    </section>

    <!-- å…³äºåŒº -->
    <section class="section" id="section-about">
      <div class="about-text">
        <h2 style="color:#ffe5b7; font-family:var(--text-typer);font-weight:600;">å…³äº Chapter CafÃ©</h2>
        <p>Chapter CafÃ© æ˜¯ä¸€ä¸ªä»¥ã€Œé˜…è¯»å¦‚å“å’–å•¡ã€ä¸ºç†å¿µçš„æ²‰æµ¸å¼å°è¯´é˜…è¯»ç½‘ç«™ã€‚åœ¨è¿™é‡Œï¼Œæ¯ä¸€æœ¬å°è¯´éƒ½åƒä¸€æ¯å’–å•¡ï¼Œå¾…ä½ ç»†ç»†å“å‘³ï¼›æ¯ä¸€ä¸ªç« èŠ‚ï¼Œéƒ½æ˜¯ä¸€æ®µç‹¬ç‰¹çš„é£å‘³æ—…ç¨‹ã€‚</p>
        <ul>
          <li><b>è§†è§‰ï¼š</b> å¤œæ™šå’–å•¡é¦†çš„è‰²è°ƒä¸ç¯å…‰ï¼Œç»†è…»æŸ”å…‰ã€ä»¿æœ¨çº¹å…ƒç´ ï¼Œä»¥åŠè½»æŸ”çš„è’¸æ±½åŠ¨æ€ã€‚</li>
          <li><b>ä½“éªŒï¼š</b> å“åº”å¼è®¾è®¡ï¼Œé€‚é…ç§»åŠ¨ç«¯ä¸å¤§å±ï¼Œä¼´æœ‰èˆ’é€‚çš„æ·¡å…¥æ·¡å‡ºåŠ¨ç”»å’Œå¡ç‰‡å…‰å½±åŠ¨æ•ˆã€‚</li>
          <li><b>ç†å¿µï¼š</b> æ•…äº‹ï¼Œæ˜¯å¦ä¸€ç§å½¢å¼çš„å’–å•¡å› ï¼Œè®©çµé­‚ä¸æƒ³è±¡è‡ªç”±å¾œå¾‰ã€‚</li>
        </ul>
        <p style="color:#a6d3ff;">ä½œè€…ï¼šä¸Šæµ·å¤§å­¦ å¤§ä¸€ ç†å­¦å·¥å­¦â…¢ç±»ï¼ˆç”µå­ä¿¡æ¯ç±»â€”ï¼‰ å´è´æ©  </p>
      </div>
    </section>
  </main>
  <!-- ====== AIå’–å•¡è±† Bean æŒ‰é’®&èŠå¤© ========= -->
  <div class="bean-fab" id="beanFab" title="å’ŒBeanèŠèŠ">
    <img src="bean1.png" alt="Bean" class="bean-emoji" />
  </div>
  <div id="bean-chat">
    <div class="bean-chat-header">â˜•ï¸ Bean - AI å’–å•¡è±†é™ªä¼´</div>
    <div class="bean-chat-messages" id="beanMessages">
      <div>æ™šä¸Šå¥½ï¼è¿™é‡Œæ˜¯Beanï¼Œæœ‰ä»€ä¹ˆæƒ³èŠçš„æ•…äº‹æˆ–å’–å•¡æ¨èå—ï¼Ÿï¼ˆç†æƒ³ä¸­æ˜¯åšä¸€ä¸ªæ™ºèƒ½ä½“æ¥å›ç­”è¯»è€…å…³äºå°è¯´çš„é—®é¢˜ï¼‰</div>
    </div>
    <form class="bean-chat-input-area" autocomplete="off">
      <input class="bean-chat-input" id="beanInput" placeholder="è¯´ç‚¹ä»€ä¹ˆå§â€¦" maxlength="100"/>
      <button class="bean-chat-send" type="submit" title="å‘é€">â¤</button>
    </form>
  </div>
  <!-- å¼•å…¥ marked.js Markdown æ¸²æŸ“åº“ -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- ====== é¡µè„š ====== -->
  <footer>
    <div>æ•…äº‹ï¼Œæ˜¯å¦ä¸€ç§å½¢å¼çš„å’–å•¡å› ã€‚</div>
    <div class="footer-social">
      <a href="#" title="å¾®åš" aria-label="å¾®åš">ğŸŒ</a>
      <a href="#" title="çŸ¥ä¹" aria-label="çŸ¥ä¹">ğŸ“</a>
      <a href="#" title="ç½‘æ˜“äº‘" aria-label="ç½‘æ˜“äº‘">ğŸµ</a>
      <a href="#" title="é‚®ç®±" aria-label="é‚®ç®±">ğŸ“§</a>
    </div>
    <div class="footer-copyright">
      Â© 2025 Chapter CafÃ© Â· Powered by Story and Coffee.
    </div>
  </footer>
  <!-- ========= è„šæœ¬äº¤äº’åŒº ========= -->
  <script>
  // ========= å¯¼èˆªèœå•æ &æŠ˜å èœå• =========
  const nav = document.getElementById('mainNav');
  const hamburger = document.getElementById('navHamburger');
  hamburger.addEventListener('click', () => {
    nav.classList.toggle('open');
  });
  // å…³é—­æŠ˜å èœå•(ç§»åŠ¨ç«¯) - ç‚¹å‡»navå¤–éƒ¨
  window.addEventListener('click', e => {
    if(window.innerWidth <= 900){
      if (!nav.contains(e.target) && !hamburger.contains(e.target)) nav.classList.remove('open');
    }
  });

  // ========= é¡µé¢åˆ‡æ¢ & å†å²è®°å½•ç®¡ç†ï¼ˆæ”¯æŒæµè§ˆå™¨å‰è¿›/åé€€ï¼‰ =========
  const sections = {
    home: document.getElementById('section-home'),
    menu: document.getElementById('section-menu'),
    reading: document.getElementById('section-reading'),
    about: document.getElementById('section-about')
  };
  const navLinks = Array.from(document.querySelectorAll('.nav-link'));

  // ä»…è´Ÿè´£æ›´æ–° DOM / æ ·å¼ï¼ˆä¸è§¦å‘ historyï¼‰
  function showSection(section) {
    for (let key in sections) {
      if (key === section) {
        sections[key].classList.add('active');
        setTimeout(()=>sections[key].scrollIntoView({behavior:'smooth', block:'start'}),80);
      } else {
        sections[key].classList.remove('active');
      }
    }
    navLinks.forEach(link => {
      if (link.dataset.section === section) link.classList.add('active');
      else link.classList.remove('active');
    });
    // å…³é—­ç§»åŠ¨ç«¯æŠ˜å èœå•
    nav.classList.remove('open');
  }

  // å¯¼èˆªåŠ¨ä½œï¼šæ›´æ–°ç•Œé¢å¹¶å†™å…¥ historyï¼ˆreplace å¯ç”¨äºåˆå§‹ï¼‰
  function navigateTo(section, replace = false) {
    showSection(section);
    const url = '#' + section;
    const state = { section };
    try {
      if (replace) history.replaceState(state, '', url);
      else history.pushState(state, '', url);
    } catch (e) {
      // æŸäº›æç«¯ç¯å¢ƒä¸‹ pushState å¯èƒ½å¤±è´¥ï¼Œå¿½ç•¥ä»¥ä¿è¯ä¸æŠ›å¼‚å¸¸
    }
  }

  navLinks.forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const run = () => navigateTo(link.dataset.section);
      if (window.guardNotesNav) window.guardNotesNav(run); else run();
    });
  });

  // ========== æ–°å¢ï¼šmenu å­å¯¼èˆªï¼ˆä½¿ç”¨ coffee-card ç›´æ¥å¯¼èˆªï¼‰ ==========
  // ä¿ç•™ scrollToMenuAnchor å‡½æ•°ï¼ˆå¦‚æœå·²æœ‰åˆ™ç”¨ç°æˆç‰ˆæœ¬ï¼‰ï¼Œè¿™é‡Œåªç»‘å®šäº‹ä»¶ï¼š
  function scrollToMenuAnchor(targetId, push = true) {
    const el = document.getElementById(targetId);
    if (!el) return;
    showSection('menu');
    setTimeout(() => {
      // æ›´æ”¹ scrollIntoView è°ƒç”¨ä»¥åœ¨æ°´å¹³æ–¹å‘å±…ä¸­
      el.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'center' });
      el.focus({preventScroll:true});
    }, 120);
    if (push) {
      try { history.pushState({ section: 'menu', sub: targetId }, '', '#' + targetId); } catch (e) {}
    }
  }

  // å°† coffee-card ä½œä¸ºå¯¼èˆªï¼ˆæ”¯æŒç‚¹å‡»å’Œå›è½¦/ç©ºæ ¼é”®ï¼‰
  const coffeeCardsNav = Array.from(document.querySelectorAll('#section-menu .coffee-card[data-target]'));
  coffeeCardsNav.forEach(card => {
    const tgt = card.dataset.target;
    card.style.cursor = 'pointer';
    card.addEventListener('click', (e) => {
      e.preventDefault();
      if (!tgt) return;
      const run = () => scrollToMenuAnchor(tgt, true);
      if (window.guardNotesNav) window.guardNotesNav(run); else run();
    });
    card.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        if (!tgt) return;
        const run = () => scrollToMenuAnchor(tgt, true);
        if (window.guardNotesNav) window.guardNotesNav(run); else run();
      }
    });
  });

  // é¦–é¡µâ€œEnter the CafÃ©â€æŒ‰é’® â†’ èœå•ï¼ˆä¿ç•™åŸæœ‰è§†è§‰åŠ¨ç”»ï¼Œå®Œæˆåå¯¼èˆªå¹¶å†™å…¥å†å²ï¼‰
  const enterBtn = document.getElementById('enterBtn');
  if (enterBtn) {
    enterBtn.addEventListener('click', () => {
      const home = sections['home'];
      home.style.transition = "opacity 0.7s, filter 0.7s";
      home.style.opacity = 0;
      home.style.filter = "blur(24px)";
      const run = () => {
        setTimeout(() => {
          // é€šè¿‡ navigateTo æ¨å…¥å†å²è®°å½•
          navigateTo('menu');
          home.style.display = 'none';
          setTimeout(() => { // ä¸ºè¿”å›é¦–é¡µæ¢å¤å¯è§†åŒ–
            home.style.opacity = 1;
            home.style.filter = 'none';
            home.style.display = '';
          }, 700);
        }, 700);
      };
      if (window.guardNotesNav) window.guardNotesNav(run); else run();
    });
  }

  // å¦‚æœé¡µé¢ä¸­å­˜åœ¨å›åˆ°é¦–é¡µçš„æŒ‰é’®åˆ™ç»‘å®šï¼ˆå…¼å®¹åŸä»£ç ï¼‰
  const backToHomeBtn = document.getElementById('backToHomeBtn');
  if (backToHomeBtn) {
    backToHomeBtn.addEventListener('click', () => {
      const run = () => navigateTo('home');
      if (window.guardNotesNav) window.guardNotesNav(run); else run();
    });
  }

  // é¡µé¢åŠ è½½æ—¶ï¼šæ ¹æ® hash æ¢å¤å¯¹åº”æ¿å—æˆ–å­é”šç‚¹ï¼ˆå¹¶ç”¨ replaceState å»ºç«‹åˆå§‹ stateï¼‰
  window.addEventListener('load', () => {
    const rawHash = (location.hash && location.hash.slice(1)) || '';
    const chapterParsed = parseReadingChapter(rawHash);
    if (chapterParsed) {
      console.log('[Init] Detected chapter hash:', rawHash);
      try {
        history.replaceState({ section:'reading', book:chapterParsed.book, chapter:chapterParsed.chapter }, '', '#' + rawHash);
      } catch(e){}
      loadRemoteChapter(chapterParsed.book, chapterParsed.chapter);
      return;
    }
    if (rawHash.startsWith('menu-')) {
      const sub = rawHash;
      try { history.replaceState({ section: 'menu', sub }, '', '#' + sub); } catch (e) {}
      showSection('menu');
      setTimeout(()=> {
        const el = document.getElementById(sub);
        if (el) el.scrollIntoView({behavior:'auto', block:'start'});
      }, 120);
      return;
    }
    const initial = rawHash || 'home';
    try { history.replaceState({ section: initial }, '', '#' + initial); } catch (e) {}
    // å¦‚æœ initial ä¸æ˜¯åˆæ³• sectionï¼Œå¼ºåˆ¶å›åˆ° home
    if(!sections[initial]) {
      showSection('home');
    } else {
      showSection(initial);
    }
  });

  // hashchange åŠ å¼ºï¼šæ”¯æŒç›´æ¥è¾“å…¥ç« èŠ‚ hash
  window.addEventListener('hashchange', () => {
    const hash = (location.hash || '').slice(1);
    const parsed = parseReadingChapter(hash);
    if(parsed){
      console.log('[Hashchange] Chapter:', parsed);
      loadRemoteChapter(parsed.book, parsed.chapter);
      return;
    }
  });

  // ====== è¿œç¨‹ç« èŠ‚åŠ è½½ï¼šæ¶æ„ / æ— äººç”Ÿè¿˜ ======
    const MALICE_BASES = [
    'https://raw.githubusercontent.com/vany0821/fiction-reading-page/main/malice/',
    'https://raw.githubusercontent.com/vany0821/fiction-reading-page/20cac8b3dadddeafee7ca1444b55834cd0d6bc88/malice/',
    'https://cdn.jsdelivr.net/gh/vany0821/fiction-reading-page@main/malice/'
  ];
  const ATTWN_BASES = [
    'https://raw.githubusercontent.com/vany0821/fiction-reading-page/main/and_then_there_were_none/',
    'https://raw.githubusercontent.com/vany0821/fiction-reading-page/20cac8b3dadddeafee7ca1444b55834cd0d6bc88/and_then_there_were_none/',
    'https://cdn.jsdelivr.net/gh/vany0821/fiction-reading-page@main/and_then_there_were_none/'
  ];
  
  function parseReadingChapter(hashStr){
    if(!hashStr) return null;
    let m = hashStr.match(/^reading-malice-chapter(\d{1,2})$/);
    if(m){
      const num = parseInt(m[1],10);
      if(num >= 1 && num <= 23) return { book:'malice', chapter:num };
      return null;
    }
    m = hashStr.match(/^reading-and_then_there_were_none-chapter(\d{1,2})$/);
    if(m){
      const num = parseInt(m[1],10);
      if(num >= 1 && num <= 16) return { book:'and_then_there_were_none', chapter:num };
      return null;
    }
    return null;
  }

  async function loadRemoteChapter(book, chapterNum){
    showSection('reading');

    const el = document.getElementById('readerContent');
    const empty = document.getElementById('readerEmpty');
    if (el) {
      el.innerText = 'æ­£åœ¨åŠ è½½ç« èŠ‚ ' + chapterNum + ' ...';
      if (empty) empty.style.display = 'none';
    }

    const cfg = (function(){
      if (book === 'malice') return { bases: MALICE_BASES, max: 23, storeKey: 'maliceCurrentChapter', detail: 'malice.html' };
      if (book === 'and_then_there_were_none') return { bases: ATTWN_BASES, max: 16, storeKey: 'attwnCurrentChapter', detail: 'and_then_there_were_none.html' };
      return null;
    })();
    if(!cfg){
      window._readerAPI && window._readerAPI.setText('æš‚ä¸æ”¯æŒçš„ä¹¦ç±ï¼š' + (book||''));
      return;
    }

    const name = `chapter${chapterNum}.txt`;
    const tried = [];
    for (const base of cfg.bases) {
      const url = base + name;
      tried.push(url);
      try {
        const resp = await fetch(url, { cache: 'no-store' });
        if (resp.ok) {
          const txt = await resp.text();
          window._readerAPI && window._readerAPI.setText(txt);
          if (typeof refreshChapterButtons === 'function') refreshChapterButtons();
          try { localStorage.setItem(cfg.storeKey, String(chapterNum)); } catch(_){ }
          console.log('[Reading] Loaded:', url, 'length=', txt.length);
          return;
        }
      } catch (e) {
        // try next base
      }
    }
    const msg = 'åŠ è½½å¤±è´¥ï¼šæœªæ‰¾åˆ°ç« èŠ‚æ–‡ä»¶ã€‚\nå·²å°è¯•ï¼š\n- ' + tried.join('\n- ');
    console.error('[Reading] All urls failed', tried);
    window._readerAPI && window._readerAPI.setText(msg);
  }

  function navigateToReadingChapter(book, chapter){
    const newHash = `reading-${book}-chapter${chapter}`;
    try {
      history.pushState({ section:'reading', book, chapter }, '', '#'+newHash);
    } catch(e){ }
    loadRemoteChapter(book, chapter);
  }

  // åˆå§‹åŠ è½½ï¼ˆæ›¿æ¢åŸ load ç›‘å¬å®ç°ï¼‰
  window.addEventListener('load', () => {
    const rawHash = (location.hash && location.hash.slice(1)) || '';
    const chapterParsed = parseReadingChapter(rawHash);
    if (chapterParsed) {
      console.log('[Init] Detected chapter hash:', rawHash);
      try {
        history.replaceState({ section:'reading', book:chapterParsed.book, chapter:chapterParsed.chapter }, '', '#' + rawHash);
      } catch(e){}
      loadRemoteChapter(chapterParsed.book, chapterParsed.chapter);
      return;
    }
    if (rawHash.startsWith('menu-')) {
      const sub = rawHash;
      try { history.replaceState({ section: 'menu', sub }, '', '#' + sub); } catch (e) {}
      showSection('menu');
      setTimeout(()=> {
        const el = document.getElementById(sub);
        if (el) el.scrollIntoView({behavior:'auto', block:'start'});
      }, 120);
      return;
    }
    const initial = rawHash || 'home';
    try { history.replaceState({ section: initial }, '', '#' + initial); } catch (e) {}
    // å¦‚æœ initial ä¸æ˜¯åˆæ³• sectionï¼Œå¼ºåˆ¶å›åˆ° home
    if(!sections[initial]) {
      showSection('home');
    } else {
      showSection(initial);
    }
  });

  // popstate æ‰©å±•
  window.addEventListener('popstate', (e) => {
    const st = e.state || {};
    if(st.section === 'reading' && st.book && st.chapter){
      showSection('reading');
      loadRemoteChapter(st.book, st.chapter);
      return;
    }
    const hashParsed = parseReadingChapter((location.hash||'').slice(1));
    if(hashParsed){
      showSection('reading');
      loadRemoteChapter(hashParsed.book, hashParsed.chapter);
      return;
    }
  });

  // è‹¥ç”¨æˆ·å·²ç»åœ¨ reading ä¸”æœ¬åœ°å­˜æœ‰ä¸Šæ¬¡ç« èŠ‚ï¼Œå¯æä¾›å¿«æ·æ¢å¤ï¼ˆéå¼ºåˆ¶ï¼‰
  window.addEventListener('DOMContentLoaded', () => {
    if(location.hash.startsWith('#reading') && !parseReadingChapter(location.hash.slice(1))){
      const lastChap = localStorage.getItem('maliceCurrentChapter');
      if(lastChap){
        // ä¸æ”¹å˜ hashï¼ˆé¿å…å¹²æ‰°ç”¨æˆ·ï¼‰ï¼Œä»…æç¤º
        const metaDiv = document.getElementById('readerContent');
        if(metaDiv && metaDiv.textContent.trim()===''){
          loadRemoteChapter('malice', lastChap);
        }
      }
    }
  });
    // ========== å’–å•¡å¡ç‰‡åŒºåŸŸå“åº”å¼è’¸æ±½éšè— ==========
  function updateSteamVisibility() {
    const steams = document.querySelectorAll('.steam');
    if(window.innerWidth <= 650){
      steams.forEach(s=>s.style.display='none');
    } else {
      steams.forEach(s=>s.style.display='flex');
    }
  }
  window.addEventListener('resize', updateSteamVisibility);
  updateSteamVisibility();

  // ========= AIå’–å•¡è±† Bean èŠå¤©äº¤äº’ Placeholder =========
  const beanFab = document.getElementById('beanFab');
  const beanChat = document.getElementById('bean-chat');
  const beanInput = document.getElementById('beanInput');
  const beanMessages = document.getElementById('beanMessages');
  beanFab.addEventListener('click', function(){
    beanChat.classList.toggle('active');
    setTimeout(()=> {
      if(beanChat.classList.contains('active')) beanInput.focus();
    }, 100);
  });
  const beanForm = beanChat.querySelector('form');
  if (beanForm) {
    beanForm.addEventListener('submit', function(e){
      e.preventDefault();
      const msg = beanInput.value.trim();
      if(msg.length === 0) return;
      addBeanMessage(msg, false);
      setTimeout(()=>{
        addBeanMessage(randomReply(), true);
      }, 900 + Math.random()*500);
      beanInput.value = '';
    });
  }
  function addBeanMessage(text, isBean){
    const div = document.createElement('div');
    div.style.margin = '6px 0';
    div.style.textAlign = isBean ? 'left' : 'right';
    div.innerHTML = isBean ?
      `<span style="color:#ffbe76;">Beanï¼š</span><span>${escapeHTML(text)}</span>` :
      `<span style="color:#7adaff;">ä½ ï¼š</span><span>${escapeHTML(text)}</span>`;
    beanMessages.appendChild(div);
    beanMessages.scrollTop = beanMessages.scrollHeight;
  }
  function randomReply(){
    const replies = [
      'æ¯ä¸€æ¯å’–å•¡éƒ½æœ‰æ•…äº‹ï¼Œä½ æ›´å–œæ¬¢å“ªç§é¦™æ°”çš„å°è¯´ï¼Ÿ',
      'ä»Šæ™šæƒ³è¯»å–å“ªç§ç±»å‹çš„æ•…äº‹ï¼Ÿ',
      'æ•…äº‹ä½™éŸµï¼Œä»¿ä½›å’–å•¡åœ¨å”‡é½¿é—´å›è¡ã€‚',
      'æˆ‘èƒ½é™ªä½ ä¸€èµ·è¯»ä¸‹å»ï½',
      'å¯¹å’–å•¡æˆ–é˜…è¯»æœ‰å›°æƒ‘ï¼ŸBeanåœ¨ï¼',
      'ä½ å¯ä»¥ç‚¹èœå•å¡ç‰‡ä½“éªŒä¸åŒé£å‘³å“¦ã€‚'
    ];
    return replies[Math.floor(Math.random() * replies.length)];
  }
  function escapeHTML(str){
    return (str+'').replace(/[<>&"']/g, s=>(
      {'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;','\'':'&#39;'}[s]
    ));
  }
  // å…³é—­BeanèŠå¤©çª— - ç‚¹å¤–éƒ¨æˆ–ESC
  window.addEventListener('click', function(e){
    if(beanChat.classList.contains('active')) {
      if(!beanChat.contains(e.target) && !beanFab.contains(e.target)){
        beanChat.classList.remove('active');
      }
    }
  });
  window.addEventListener('keydown', function(e){
    if(e.key==="Escape" && beanChat.classList.contains('active')){
      beanChat.classList.remove('active');
    }
  });

  // ========== æŸ”å’Œç¯å…‰èƒŒæ™¯åŠ¨æ€ ==========
  let tick=0;
  setInterval(()=>{
    document.body.style.backgroundPosition =
      (62+8*Math.sin(tick/95))+"% "+(51+3*Math.cos(tick/105))+"%";
    tick++;
  }, 170);
  </script>
</body>
</html>


